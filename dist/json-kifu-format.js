module.exports=function(r){var t={};function e(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return r[o].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=r,e.c=t,e.d=function(r,t,o){e.o(r,t)||Object.defineProperty(r,t,{enumerable:!0,get:o})},e.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,t){if(1&t&&(r=e(r)),8&t)return r;if(4&t&&"object"==typeof r&&r&&r.__esModule)return r;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:r}),2&t&&"string"!=typeof r)for(var n in r)e.d(o,n,function(t){return r[t]}.bind(null,n));return o},e.n=function(r){var t=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(t,"a",t),t},e.o=function(r,t){return Object.prototype.hasOwnProperty.call(r,t)},e.p="",e(e.s=3)}([function(r,t){r.exports=function(r){var t={};function e(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return r[o].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=r,e.c=t,e.d=function(r,t,o){e.o(r,t)||Object.defineProperty(r,t,{enumerable:!0,get:o})},e.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,t){if(1&t&&(r=e(r)),8&t)return r;if(4&t&&"object"==typeof r&&r&&r.__esModule)return r;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:r}),2&t&&"string"!=typeof r)for(var n in r)e.d(o,n,function(t){return r[t]}.bind(null,n));return o},e.n=function(r){var t=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(t,"a",t),t},e.o=function(r,t){return Object.prototype.hasOwnProperty.call(r,t)},e.p="",e(e.s=3)}([function(r,t,e){"use strict";var o;t.__esModule=!0,function(r){r[r.Black=0]="Black",r[r.White=1]="White"}(o||(o={})),t.default=o},function(r,t,e){"use strict";t.__esModule=!0,t.MOVE_DEF=t.PRESET=void 0;var o=e(0),n=" *  *  *  *  *  *  *  *  * ",i=["-FU-FU-FU-FU-FU-FU-FU-FU-FU",n,n,n,"+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],u=[n].concat(i);t.PRESET={HIRATE:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  * -KA * "].concat(i),turn:o.default.Black},KY:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "," * -HI *  *  *  *  * -KA * "].concat(i),turn:o.default.White},KY_R:{board:[" * -KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  * -KA * "].concat(i),turn:o.default.White},KA:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  *  *  * "].concat(i),turn:o.default.White},HI:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," *  *  *  *  *  *  * -KA * "].concat(i),turn:o.default.White},HIKY:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "," *  *  *  *  *  *  * -KA * "].concat(i),turn:o.default.White},2:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"].concat(u),turn:o.default.White},3:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "].concat(u),turn:o.default.White},4:{board:[" * -KE-GI-KI-OU-KI-GI-KE * "].concat(u),turn:o.default.White},5:{board:[" *  * -GI-KI-OU-KI-GI-KE * "].concat(u),turn:o.default.White},"5_L":{board:[" * -KE-GI-KI-OU-KI-GI *  * "].concat(u),turn:o.default.White},6:{board:[" *  * -GI-KI-OU-KI-GI *  * "].concat(u),turn:o.default.White},8:{board:[" *  *  * -KI-OU-KI *  *  * "].concat(u),turn:o.default.White},10:{board:[" *  *  *  * -OU *  *  *  * "].concat(u),turn:o.default.White}};var a=[0,-1],s=[0,1],c=[1,0],l=[-1,0],f=[-1,-1],h=[1,-1],d=[-1,1],p=[1,1],v={just:[f,a,h,l,c,s]};t.MOVE_DEF={FU:{just:[a]},KY:{fly:[a]},KE:{just:[[-1,-2],[1,-2]]},GI:{just:[f,a,h,d,p]},KI:v,TO:v,NY:v,NK:v,NG:v,KA:{fly:[f,h,d,p]},HI:{fly:[a,l,c,s]},OU:{just:[f,a,h,l,c,d,s,p]},UM:{fly:[f,h,d,p],just:[a,l,c,s]},RY:{fly:[a,l,c,s],just:[f,h,d,p]}}},function(r,t,e){"use strict";t.__esModule=!0;var o=e(0),n=function(){function r(r){this.color="+"===r.slice(0,1)?o.default.Black:o.default.White,this.kind=r.slice(1)}return r.promote=function(r){return{FU:"TO",KY:"NY",KE:"NK",GI:"NG",KA:"UM",HI:"RY"}[r]||r},r.unpromote=function(r){return{TO:"FU",NY:"KY",NK:"KE",NG:"GI",KI:"KI",UM:"KA",RY:"HI",OU:"OU"}[r]||r},r.canPromote=function(t){return r.promote(t)!==t},r.isPromoted=function(r){return["TO","NY","NK","NG","UM","RY"].indexOf(r)>=0},r.oppositeColor=function(r){return r===o.default.Black?o.default.White:o.default.Black},r.fromSFENString=function(t){var e="+"===t[0];e&&(t=t.slice(1));var o=new r((t.match(/[A-Z]/)?"+":"-")+{P:"FU",L:"KY",N:"KE",S:"GI",G:"KI",B:"KA",R:"HI",K:"OU"}[t.toUpperCase()]);return e&&o.promote(),o},r.prototype.promote=function(){this.kind=r.promote(this.kind)},r.prototype.unpromote=function(){this.kind=r.unpromote(this.kind)},r.prototype.inverse=function(){this.color=this.color===o.default.Black?o.default.White:o.default.Black},r.prototype.toCSAString=function(){return(this.color===o.default.Black?"+":"-")+this.kind},r.prototype.toSFENString=function(){var t={FU:"P",KY:"L",KE:"N",GI:"S",KI:"G",KA:"B",HI:"R",OU:"K"}[r.unpromote(this.kind)];return(r.isPromoted(this.kind)?"+":"")+(this.color===o.default.Black?t:t.toLowerCase())},r}();t.default=n},function(r,t,e){"use strict";t.__esModule=!0,t.Piece=t.Color=t.Shogi=void 0;
/** @license
 * Shogi.js
 * Copyright (c) 2014 na2hiro (https://github.com/na2hiro)
 * This software is released under the MIT License.
 * http://opensource.org/licenses/mit-license.php
 */
var o=e(0);t.Color=o.default;var n=e(1),i=e(2);t.Piece=i.default,e(4);var u=e(5),a=function(){function r(r){this.initialize(r)}return r.getIllegalUnpromotedRow=function(r){switch(r){case"FU":case"KY":return 1;case"KE":return 2;default:return 0}},r.getRowToOppositeEnd=function(r,t){return t===o.default.Black?r:10-r},r.prototype.initialize=function(r){void 0===r&&(r={preset:"HIRATE"}),u.fromPreset(this,r),this.flagEditMode=!1},r.prototype.initializeFromSFENString=function(r){u.fromSfen(this,r)},r.prototype.toCSAString=function(){return u.toCSA(this)},r.prototype.toSFENString=function(r){return void 0===r&&(r=1),u.toSfen(this,r)},r.prototype.editMode=function(r){this.flagEditMode=r},r.prototype.move=function(t,e,o,n,i){void 0===i&&(i=!1);var u=this.get(t,e);if(null==u)throw new Error("no piece found at "+t+", "+e);if(this.checkTurn(u.color),!this.flagEditMode&&!this.getMovesFrom(t,e).some((function(r){return r.to.x===o&&r.to.y===n})))throw new Error("cannot move from "+t+", "+e+" to "+o+", "+n);null!=this.get(o,n)&&this.capture(o,n);var a=r.getIllegalUnpromotedRow(u.kind)>=r.getRowToOppositeEnd(n,u.color);(i||a)&&u.promote(),this.set(o,n,u),this.set(t,e,null),this.nextTurn()},r.prototype.unmove=function(r,t,e,o,n,u){void 0===n&&(n=!1);var a,s=this.get(e,o);if(null==s)throw new Error("no piece found at "+e+", "+o);this.checkTurn(i.default.oppositeColor(s.color)),u&&(a=this.popFromHand(i.default.unpromote(u),s.color)).inverse();var c=this.flagEditMode;this.editMode(!0),this.move(e,o,r,t),n&&s.unpromote(),u&&(i.default.isPromoted(u)&&a.promote(),this.set(e,o,a)),this.editMode(c),this.prevTurn()},r.prototype.drop=function(r,t,e,o){if(void 0===o&&(o=this.turn),this.checkTurn(o),null!=this.get(r,t))throw new Error("there is a piece at "+r+", "+t);if(!this.getDropsBy(o).some((function(o){return o.to.x===r&&o.to.y===t&&o.kind===e})))throw new Error("Cannot move");var n=this.popFromHand(e,o);this.set(r,t,n),this.nextTurn()},r.prototype.undrop=function(r,t){var e=this.get(r,t);if(null==e)throw new Error("there is no piece at "+r+", "+t);this.checkTurn(i.default.oppositeColor(e.color)),this.pushToHand(e),this.set(r,t,null),this.prevTurn()},r.prototype.getMovesFrom=function(r,t){var e=function(r,t,e){if(r<1||9<r||t<1||9<t)return!1;var o=this.get(r,t);return null==o||o.color!==e}.bind(this),i=function(r,t,e){var o=this.get(r,t);return null!=o&&o.color!==e}.bind(this),u=this.get(r,t);if(null==u)return[];var a=n.MOVE_DEF[u.kind],s=[],c={x:r,y:t},l=u.color===o.default.Black?1:-1;if(a.just)for(var f=0,h=a.just;f<h.length;f++){var d=h[f];e((m={x:c.x+d[0]*l,y:c.y+d[1]*l}).x,m.y,u.color)&&s.push({from:c,to:m})}if(a.fly)for(var p=0,v=a.fly;p<v.length;p++){d=v[p];for(var m={x:c.x+d[0]*l,y:c.y+d[1]*l};e(m.x,m.y,u.color)&&(s.push({from:c,to:{x:m.x,y:m.y}}),!i(m.x,m.y,u.color));)m.x+=d[0]*l,m.y+=d[1]*l}return s},r.prototype.getDropsBy=function(t){for(var e=[],o=[],n=[],i=1;i<=9;i++){for(var u=!1,a=1;a<=9;a++){var s=this.get(i,a);null==s?o.push({x:i,y:a}):s.color===t&&"FU"===s.kind&&(u=!0)}n.push(u)}for(var c={},l=0,f=this.hands[t];l<f.length;l++){var h=f[l].kind;if(!c[h]){c[h]=!0;for(var d=r.getIllegalUnpromotedRow(h),p=0,v=o;p<v.length;p++){var m=v[p];"FU"===h&&n[m.x-1]||d>=r.getRowToOppositeEnd(m.y,t)||e.push({to:m,color:t,kind:h})}}}return e},r.prototype.getMovesTo=function(r,t,e,o){void 0===o&&(o=this.turn);for(var n={x:r,y:t},i=[],u=1;u<=9;u++)for(var a=1;a<=9;a++){var s=this.get(u,a);s&&s.kind===e&&s.color===o&&this.getMovesFrom(u,a).some((function(e){return e.to.x===r&&e.to.y===t}))&&i.push({from:{x:u,y:a},to:n})}return i},r.prototype.get=function(r,t){return this.board[r-1][t-1]},r.prototype.getHandsSummary=function(r){for(var t={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0},e=0,o=this.hands[r];e<o.length;e++)t[o[e].kind]++;return t},r.prototype.captureByColor=function(r,t,e){if(!this.flagEditMode)throw new Error("cannot edit board without editMode");var o=this.get(r,t);this.set(r,t,null),o.unpromote(),o.color!==e&&o.inverse(),this.pushToHand(o)},r.prototype.flip=function(r,t){if(!this.flagEditMode)throw new Error("cannot edit board without editMode");var e=this.get(r,t);return!!e&&(i.default.isPromoted(e.kind)?(e.unpromote(),e.inverse()):i.default.canPromote(e.kind)?e.promote():e.inverse(),!0)},r.prototype.setTurn=function(r){if(!this.flagEditMode)throw new Error("cannot set turn without editMode");this.turn=r},r.prototype.set=function(r,t,e){this.board[r-1][t-1]=e},r.prototype.capture=function(r,t){var e=this.get(r,t);this.set(r,t,null),e.unpromote(),e.inverse(),this.pushToHand(e)},r.prototype.pushToHand=function(r){this.hands[r.color].push(r)},r.prototype.popFromHand=function(r,t){for(var e=this.hands[t],o=0;o<e.length;o++)if(e[o].kind===r){var n=e[o];return e.splice(o,1),n}throw new Error(t+" has no "+r)},r.prototype.nextTurn=function(){this.flagEditMode||(this.turn=this.turn===o.default.Black?o.default.White:o.default.Black)},r.prototype.prevTurn=function(){this.flagEditMode||this.nextTurn()},r.prototype.checkTurn=function(r){if(!this.flagEditMode&&r!==this.turn)throw new Error("cannot move opposite piece")},r}();t.Shogi=a},function(r,t,e){"use strict";t.__esModule=!0,Array.prototype.some||(Array.prototype.some=function(r){if(null==this)throw new TypeError;var t=Object(this),e=t.length>>>0;if("function"!=typeof r)throw new TypeError;for(var o=arguments[1],n=0;n<e;n++)if(n in t&&r.call(o,t[n],n,t))return!0;return!1})},function(r,t,e){"use strict";t.__esModule=!0,t.toSfen=t.fromSfen=t.toCSA=t.fromPreset=void 0;var o=e(0),n=e(1),i=e(2);t.fromPreset=function(r,t){var e,u=[],a=[[],[]];if("OTHER"!==t.preset){for(var s=0;s<9;s++){u[s]=[];for(var c=0;c<9;c++){var l=n.PRESET[t.preset].board[c].slice(24-3*s,24-3*s+3);u[s][c]=" * "===l?null:new i.default(l)}}e=n.PRESET[t.preset].turn}else{for(s=0;s<9;s++)for(u[s]=[],c=0;c<9;c++){var f=t.data.board[s][c];u[s][c]=f.kind?new i.default((f.color===o.default.Black?"+":"-")+f.kind):null}e=t.data.color;for(var h=0;h<2;h++)for(var d in t.data.hands[h])if(t.data.hands[h].hasOwnProperty(d))for(l=(0===h?"+":"-")+d,s=0;s<t.data.hands[h][d];s++)a[h].push(new i.default(l))}r.board=u,r.turn=e,r.hands=a},t.toCSA=function(r){for(var t=[],e=0;e<9;e++){for(var n="P"+(e+1),i=8;i>=0;i--){var u=r.board[i][e];n+=null==u?" * ":u.toCSAString()}t.push(n)}for(var a=0;a<2;a++){n="P"+"+-"[a];for(var s=0,c=r.hands[a];s<c.length;s++)n+="00"+c[s].kind;t.push(n)}return t.push(r.turn===o.default.Black?"+":"-"),t.join("\n")},t.fromSfen=function(r,t){for(var e=[],n=0;n<9;n++){e[n]=[];for(var u=0;u<9;u++)e[n][u]=null}var a=t.split(" "),s=a[0],c=8,l=0;for(n=0;n<s.length;n++){var f=s[n];"+"===f&&(f+=s[++n]),f.match(/^[1-9]$/)?c-=Number(f):"/"===f?(l++,c=8):(e[c][l]=i.default.fromSFENString(f),c--)}r.board=e,r.turn="b"===a[1]?o.default.Black:o.default.White;var h=[[],[]],d=a[2];if("-"!==d)for(;d.length>0;){var p=1,v=d.match(/^[0-9]+/);for(v&&(p=Number(v[0]),d=d.slice(v[0].length)),n=0;n<p;n++){var m=i.default.fromSFENString(d[0]);h[m.color].push(m)}d=d.slice(1)}r.hands=h},t.toSfen=function(r,t){for(var e=[],n=[],i=0;i<9;i++){for(var u="",a=0,s=8;s>=0;s--){var c=r.board[s][i];null==c?a++:(a>0&&(u+=""+a,a=0),u+=c.toSFENString())}a>0&&(u+=""+a),n.push(u)}if(e.push(n.join("/")),e.push(r.turn===o.default.Black?"b":"w"),0===r.hands[0].length&&0===r.hands[1].length)e.push("-");else{for(var l="",f={},h=0;h<2;h++)for(var d=0,p=r.hands[h];d<p.length;d++){var v=p[d].toSFENString();f[v]=(f[v]||0)+1}for(var m=0,g=["R","B","G","S","N","L","P","r","b","g","s","n","l","p"];m<g.length;m++){var A=g[m];f[A]>0&&(l+=(f[A]>1?f[A]:"")+A)}e.push(l)}return e.push(""+t),e.join(" ")}}])},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeCSA=t.normalizeKI2=t.normalizeKIF=t.normalizeMinimal=t.canPromote=void 0;
/** @license
 * JSON Kifu Format
 * Copyright (c) 2014 na2hiro (https://github.com/na2hiro)
 * This software is released under the MIT License.
 * http://opensource.org/licenses/mit-license.php
 */
var o=e(0);function n(r,t){return t===o.Color.Black?r.y<=3:r.y>=7}function i(r,t){var e=r.getMovesTo(t.to.x,t.to.y,t.piece).map((function(t){return a(r.turn,c(t.to,t.from))}));if(e.length>=2){var o=a(r.turn,c(t.to,t.from));t.relative=1===e.filter((function(r){return r.y===o.y})).length?l(o.y):1===e.filter((function(r){return r.x===o.x})).length?"UM"!==t.piece&&"RY"!==t.piece||0!==o.x?f(o.x):f(0===e.filter((function(r){return r.x<0})).length?-1:1):f(o.x)+l(o.y)}}function u(r,t){var e=r.get(t.to.x,t.to.y);e&&(t.capture=e.kind)}function a(r,t){return r===o.Color.Black?t:{x:-t.x,y:-t.y}}function s(r,t){return r===t?0:r>t?1:-1}function c(r,t){return{x:s(r.x,t.x),y:s(r.y,t.y)}}function l(r){return 0===r?"M":r>0?"D":"U"}function f(r){return 0===r?"C":r>0?"R":"L"}function h(r,t,e){for(var o=[],n=function(e){r.split("").every((function(r){return function(r,t,e){var o=a(t,{x:e.to.x-e.from.x,y:e.to.y-e.from.y});switch(r){case"U":return o.y<0;case"M":return 0===o.y;case"D":return o.y>0;case"L":return o.x<0;case"C":return 0===o.x;case"R":return o.x>0}}(r,t,e)}))&&o.push(e)},i=0,u=e;i<u.length;i++){n(u[i])}return o}function d(r,t){r.length>=1&&"ILLEGAL_ACTION"===r[r.length-1].special&&(r[r.length-1].special=(t.turn?"+":"-")+"ILLEGAL_ACTION")}function p(r,t){void 0===t&&(t={now:{m:0,s:0},total:{h:0,m:0,s:0}}),r&&(r.total={h:(r.now.h||0)+t.total.h,m:r.now.m+t.total.m,s:r.now.s+t.total.s},r.total.m+=Math.floor(r.total.s/60),r.total.s=r.total.s%60,r.total.h+=Math.floor(r.total.m/60),r.total.m=r.total.m%60)}t.canPromote=n,t.normalizeMinimal=function(r){return function r(t,e,a){for(var s=0;s<e.length;s++){var c=0===s?a:e[s-1];if(l=e[s].move)if(l.color=t.turn,l.from){c&&c.move&&l.to.x===c.move.to.x&&l.to.y===c.move.to.y&&(l.same=!0),u(t,l),l.piece||(l.piece=t.get(l.from.x,l.from.y).kind),l.promote||o.Piece.isPromoted(l.piece)||!o.Piece.canPromote(l.piece)||(n(l.to,t.turn)||n(l.from,t.turn))&&(l.promote=!1),i(t,l);try{t.move(l.from.x,l.from.y,l.to.x,l.to.y,l.promote)}catch(r){throw new Error(s+"手目で失敗しました: "+r)}}else t.getMovesTo(l.to.x,l.to.y,l.piece).length>0&&(l.relative="H"),t.drop(l.to.x,l.to.y,l.piece)}d(e,t);for(s=e.length-1;s>=0;s--){var l;(l=e[s].move)&&(l.from?t.unmove(l.from.x,l.from.y,l.to.x,l.to.y,l.promote,l.capture):t.undrop(l.to.x,l.to.y));c=s<=1?a:e[s-1];if(e[s].forks)for(var f=0,h=e[s].forks;f<h.length;f++){var p=h[f];r(t,p,c)}}}(new o.Shogi(r.initial||void 0),r.moves),r},t.normalizeKIF=function(r){return r.initial&&"HIRATE"===r.initial.preset&&r.initial.data&&(r.initial.preset="OTHER"),function r(t,e,a){for(var s=0;s<e.length;s++){var c=0===s?a:e[s-1];if(l=e[s].move)if(l.color=t.turn,l.from){l.same&&(l.to=c.move.to),u(t,l),l.promote||o.Piece.isPromoted(l.piece)||!o.Piece.canPromote(l.piece)||(n(l.to,t.turn)||n(l.from,t.turn))&&(l.promote=!1),i(t,l);try{t.move(l.from.x,l.from.y,l.to.x,l.to.y,l.promote)}catch(r){throw new Error(s+"手目で失敗しました: "+r)}}else t.getMovesTo(l.to.x,l.to.y,l.piece).length>0&&(l.relative="H"),t.drop(l.to.x,l.to.y,l.piece)}d(e,t);for(s=e.length-1;s>=0;s--){var l;(l=e[s].move)&&(l.from?t.unmove(l.from.x,l.from.y,l.to.x,l.to.y,l.promote,l.capture):t.undrop(l.to.x,l.to.y));c=0===s?a:e[s-1];if(e[s].forks)for(var f=0,h=e[s].forks;f<h.length;f++){var p=h[f];r(t,p,c)}}}(new o.Shogi(r.initial||void 0),r.moves),r},t.normalizeKI2=function(r){return function r(t,e,o){for(var n=0;n<e.length;n++){var i=0===n?o:e[n-1];if(c=e[n].move){c.color=t.turn,c.same&&(c.to=i.move.to);var a=t.getMovesTo(c.to.x,c.to.y,c.piece);if("H"===c.relative||0===a.length);else if(1===a.length)c.from=a[0].from;else{var s=h(c.relative,t.turn,a);if(1!==s.length)throw new Error("相対情報が不完全で複数の候補があります");c.from=s[0].from}if(c.from){u(t,c);try{t.move(c.from.x,c.from.y,c.to.x,c.to.y,c.promote)}catch(r){throw new Error(n+"手目で失敗しました: "+r)}}else t.drop(c.to.x,c.to.y,c.piece)}}d(e,t);for(n=e.length-1;n>=0;n--){var c;if(c=e[n].move){c.from?t.unmove(c.from.x,c.from.y,c.to.x,c.to.y,c.promote,c.capture):t.undrop(c.to.x,c.to.y);i=n<=1?o:e[n-1];if(e[n].forks)for(var l=0,f=e[n].forks;l<f.length;l++){var p=f[l];r(t,p,i)}}}}(new o.Shogi(r.initial||void 0),r.moves),r},t.normalizeCSA=function(r){!function(r){if(!r.initial||"OTHER"!==r.initial.preset)return;for(var t=["FU","KY","KE","GI","KI","KA","HI"],e=0;e<2;e++)for(var n=0,i=t;n<i.length;n++){var u=i[n];if(0!==r.initial.data.hands[e][u])return}var a=[[{color:o.Color.White,kind:"KY"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"KY"}],[{color:o.Color.White,kind:"KE"},{color:o.Color.White,kind:"KA"},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{color:o.Color.Black,kind:"HI"},{color:o.Color.Black,kind:"KE"}],[{color:o.Color.White,kind:"GI"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"GI"}],[{color:o.Color.White,kind:"KI"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"KI"}],[{color:o.Color.White,kind:"OU"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"OU"}],[{color:o.Color.White,kind:"KI"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"KI"}],[{color:o.Color.White,kind:"GI"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"GI"}],[{color:o.Color.White,kind:"KE"},{color:o.Color.White,kind:"HI"},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{color:o.Color.Black,kind:"KA"},{color:o.Color.Black,kind:"KE"}],[{color:o.Color.White,kind:"KY"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"KY"}]],s=[];for(e=0;e<9;e++)for(var c=0;c<9;c++)l=r.initial.data.board[e][c],f=a[e][c],void 0===l.color&&void 0===f.color||void 0!==l.color&&void 0!==f.color&&l.color===f.color&&l.kind===f.kind||s.push(""+(e+1)+(c+1));var l,f;var h={"":"HIRATE"};h[11]="KY",h[91]="KY_R",h[22]="KA",h[82]="HI",h[1182]="HIKY",h[2282]="2",h[228291]="3",h[11228291]="4",h[1122818291]="5",h[1121228291]="5_L",h[112122818291]="6",h[0x3fbbf1cdec333]="8",h["11212231416171818291"]="10";var d=h[s.sort().join("")];"HIRATE"===d?r.initial.data.color===o.Color.Black&&(r.initial.preset="HIRATE",delete r.initial.data):d&&r.initial.data.color===o.Color.White&&(r.initial.preset=d,delete r.initial.data)}(r);for(var t=new o.Shogi(r.initial||void 0),e=0;e<r.moves.length;e++){p(r.moves[e].time,e>=2?r.moves[e-2].time:void 0);var a=r.moves[e].move;if(a)if(a.color=t.turn,a.from){if(e>0&&r.moves[e-1].move&&r.moves[e-1].move.to.x===a.to.x&&r.moves[e-1].move.to.y===a.to.y&&(a.same=!0),u(t,a),o.Piece.isPromoted(a.piece)){var s=t.get(a.from.x,a.from.y);s.kind!==a.piece&&(a.piece=s.kind,a.promote=!0)}else o.Piece.canPromote(a.piece)&&(n(a.to,t.turn)||n(a.from,t.turn))&&(a.promote=!1);i(t,a);try{t.move(a.from.x,a.from.y,a.to.x,a.to.y,a.promote)}catch(r){throw new Error(e+"手目で失敗しました: "+r)}}else t.getMovesTo(a.to.x,a.to.y,a.piece).length>0&&(a.relative="H"),t.drop(a.to.x,a.to.y,a.piece)}return r}},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseKI2=t.parseKIF=t.parseCSA=void 0,e(6);var o=e(7),n=e(8),i=e(9);t.parseCSA=function(r){return o.parse(r)},t.parseKIF=function(r){return i.parse(r)},t.parseKI2=function(r){return n.parse(r)}},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Formats=t.Parsers=t.JKFPlayer=t.Normalizer=void 0;var o=e(4);t.Formats=o;var n=e(5);t.JKFPlayer=n.default;var i=e(1);t.Normalizer=i;var u=e(2);t.Parsers=u},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(r,t,e){"use strict";
/** @license
 * JSON Kifu Format
 * Copyright (c) 2014 na2hiro (https://github.com/na2hiro)
 * This software is released under the MIT License.
 * http://opensource.org/licenses/mit-license.php
 */Object.defineProperty(t,"__esModule",{value:!0});var o=e(0),n=e(1),i=e(2),u=function(){function r(r){this.forkPointers=[],this.forks_=null,this.currentStream_=null,this.shogi=new o.Shogi(r.initial||void 0),this.initialize(r)}return r.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];r.debug?console.log(t):r.logs.push(t)},r.parse=function(t,e){if(e){var o=e.split(".");switch(o[o.length-1].toLowerCase()){case"jkf":return r.parseJKF(t);case"kif":case"kifu":return r.parseKIF(t);case"ki2":case"ki2u":return r.parseKI2(t);case"csa":return r.parseCSA(t)}}try{return r.parseJKF(t)}catch(t){r.log("failed to parse as jkf",t)}try{return r.parseKIF(t)}catch(t){r.log("failed to parse as kif",t)}try{return r.parseKI2(t)}catch(t){r.log("failed to parse as ki2",t)}try{return r.parseCSA(t)}catch(t){r.log("failed to parse as csa",t)}throw new Error("JKF, KIF, KI2, CSAいずれの形式でも失敗しました")},r.parseJKF=function(t){return r.log("parseJKF",t),new r(JSON.parse(t))},r.parseKIF=function(t){return r.log("parseKIF",t),new r(n.normalizeKIF(i.parseKIF(r.addLastNewLine(t))))},r.parseKI2=function(t){return r.log("parseKI2",t),new r(n.normalizeKI2(i.parseKI2(r.addLastNewLine(t))))},r.parseCSA=function(t){return r.log("parseCSA",t),new r(n.normalizeCSA(i.parseCSA(r.addLastNewLine(t))))},r.addLastNewLine=function(r){return"\n"===r.substr(r.length-1)?r:r+"\n"},r.numToZen=function(r){return"０１２３４５６７８９"[r]},r.numToKan=function(r){return"〇一二三四五六七八九"[r]},r.kindToKan=function(r){return{FU:"歩",KY:"香",KE:"桂",GI:"銀",KI:"金",KA:"角",HI:"飛",OU:"玉",TO:"と",NY:"成香",NK:"成桂",NG:"成銀",UM:"馬",RY:"龍"}[r]},r.relativeToKan=function(r){return{L:"左",C:"直",R:"右",U:"上",M:"寄",D:"引",H:"打"}[r]},r.specialToKan=function(r){return{TORYO:"投了",CHUDAN:"中断",SENNICHITE:"千日手",TIME_UP:"時間切れ",ILLEGAL_MOVE:"反則負け","+ILLEGAL_ACTION":"後手反則負け","-ILLEGAL_ACTION":"先手反則負け",JISHOGI:"持将棋",KACHI:"勝ち宣言",HIKIWAKE:"引き分け宣言",MATTA:"待った",TSUMI:"詰",FUZUMI:"不詰",ERROR:"エラー"}[r]||r},r.moveToReadableKifu=function(t){if(t.special)return r.specialToKan(t.special);var e=t.move,n=e.color===o.Color.Black?"☗":"☖";return e.same?n+="同　":n+=r.numToZen(e.to.x)+r.numToKan(e.to.y),n+=r.kindToKan(e.piece),e.relative&&(n+=e.relative.split("").map(r.relativeToKan).join("")),null!=e.promote&&(n+=e.promote?"成":"不成"),n},r.doMove=function(r,t){t&&(t.from?r.move(t.from.x,t.from.y,t.to.x,t.to.y,t.promote):r.drop(t.to.x,t.to.y,t.piece,void 0!==t.color?t.color:void 0))},r.undoMove=function(r,t){t&&(t.from?r.unmove(t.from.x,t.from.y,t.to.x,t.to.y,t.promote,t.capture):r.undrop(t.to.x,t.to.y))},r.getState=function(t){return{board:r.getBoardState(t),color:t.turn,hands:r.getHandsState(t)}},r.sameMoveMinimal=function(r,t){return r.to.x===t.to.x&&r.to.y===t.to.y&&(r.from&&t.from?r.from.x===t.from.x&&r.from.y===t.from.y&&r.promote===t.promote:r.piece===t.piece)},r.getBoardState=function(r){for(var t=[],e=1;e<=9;e++){for(var o=[],n=1;n<=9;n++){var i=r.get(e,n);o.push(i?{color:i.color,kind:i.kind}:{})}t.push(o)}return t},r.getHandsState=function(r){return[r.getHandsSummary(o.Color.Black),r.getHandsSummary(o.Color.White)]},Object.defineProperty(r.prototype,"forks",{get:function(){return null===this.forks_&&this.updateForksAndCurrentStream(),this.forks_},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentStream",{get:function(){return null===this.currentStream_&&this.updateForksAndCurrentStream(),this.currentStream_},enumerable:!1,configurable:!0}),r.prototype.initialize=function(r){this.kifu=r,this.tesuu=0,this.forkPointers=[]},r.prototype.forward=function(){var t=this.getMoveFormat(this.tesuu+1);if(!t)return!1;this.tesuu++;var e=t.move;return!e||(r.log("forward",this.tesuu,e),this.doMove(e),!0)},r.prototype.backward=function(){var t=this;if(this.tesuu<=0)return!1;var e=this.getMoveFormat(this.tesuu).move;return r.log("backward",this.tesuu-1,e),this.undoMove(e),this.tesuu--,this.forkPointers=this.forkPointers.filter((function(r){return r.te<=t.tesuu})),this.updateForksAndCurrentStream(),!0},r.prototype.goto=function(r){if("string"==typeof r&&(r=Number(r)),!isNaN(r)){var t=1e4;if(this.tesuu<r)for(;this.tesuu!==r&&this.forward()&&t-- >0;);else for(;this.tesuu!==r&&this.backward()&&t-- >0;);if(0===t)throw new Error("tesuu overflows")}},r.prototype.go=function(r){"string"==typeof r&&(r=Number(r)),isNaN(r)||this.goto(this.tesuu+r)},r.prototype.forkAndForward=function(r){"string"==typeof r&&(r=parseInt(r,10));var t=this.getMoveFormat(this.tesuu+1).forks;return!(!t||t.length<=r)&&(this.forkPointers.push({te:this.tesuu+1,forkIndex:r}),this.updateForksAndCurrentStream(),this.forward())},r.prototype.inputMove=function(t){if(this.getMoveFormat().special)throw new Error("終了局面へ棋譜を追加することは出来ません");if(null!=t.from&&null==t.promote){var e=this.shogi.get(t.from.x,t.from.y);if(!o.Piece.isPromoted(e.kind)&&o.Piece.canPromote(e.kind)&&(n.canPromote(t.from,e.color)||n.canPromote(t.to,e.color)))return!1}var i=this.getMoveFormat(this.tesuu+1);if(i){if(i.move&&r.sameMoveMinimal(i.move,t))return this.forward(),!0;if(i.forks)for(var u=0;u<i.forks.length;u++){var a=i.forks[u][0];if(a&&a.move&&r.sameMoveMinimal(a.move,t))return this.forkAndForward(u),!0}}this.doMove(t);var s,c={move:t},l=this.tesuu<this.getMaxTesuu();return l?((s=this.getMoveFormat(this.tesuu+1)).forks||(s.forks=[]),s.forks.push([c])):this.forks[this.forks.length-1].moves.push(c),this.updateForksAndCurrentStream(),n.normalizeMinimal(this.kifu),this.undoMove(t),l?this.forkAndForward(s.forks.length-1):this.forward(),!0},r.prototype.getBoard=function(r,t){return this.shogi.get(r,t)},r.prototype.getComments=function(r){return void 0===r&&(r=this.tesuu),this.getMoveFormat(r).comments||[]},r.prototype.getMove=function(r){return void 0===r&&(r=this.tesuu),this.getMoveFormat(r).move},r.prototype.getReadableKifu=function(t){return void 0===t&&(t=this.tesuu),0===t?"開始局面":r.moveToReadableKifu(this.getMoveFormat(t))},r.prototype.getReadableForkKifu=function(t){return void 0===t&&(t=this.tesuu),this.getNextFork(t).map((function(t){return r.moveToReadableKifu(t[0])}))},r.prototype.getMaxTesuu=function(){return this.currentStream.length-1},r.prototype.toJKF=function(){return JSON.stringify(this.kifu)},r.prototype.getState=function(){return r.getState(this.shogi)},r.prototype.getReadableKifuState=function(){for(var r=[],t=0;t<=this.getMaxTesuu();t++)r.push({comments:this.getComments(t),forks:this.getReadableForkKifu(t-1),kifu:this.getReadableKifu(t)});return r},r.prototype.updateForksAndCurrentStream=function(){for(var r=[],t=[],e=this.kifu.moves,o=0,n=0,i=this.forkPointers;n<i.length;n++){var u=i[n];r.push({te:o,moves:e}),t=t.concat(e.slice(0,u.te-o)),e=e[u.te-o].forks[u.forkIndex],o=u.te}r.push({te:o,moves:e}),this.forks_=r,this.currentStream_=t.concat(e.slice())},r.prototype.getMoveFormat=function(r){return void 0===r&&(r=this.tesuu),this.currentStream[r]},r.prototype.getNextFork=function(r){void 0===r&&(r=this.tesuu);var t=this.getMoveFormat(r+1);return t&&t.forks?t.forks:[]},r.prototype.doMove=function(t){r.doMove(this.shogi,t)},r.prototype.undoMove=function(t){r.undoMove(this.shogi,t)},r.debug=!1,r.logs=[],r}();t.default=u},function(r,t){},function(r,t,e){"use strict";function o(r,t,e,n){this.message=r,this.expected=t,this.found=e,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,o)}!function(r,t){function e(){this.constructor=r}e.prototype=t.prototype,r.prototype=new e}(o,Error),o.buildMessage=function(r,t){var e={literal:function(r){return'"'+n(r.text)+'"'},class:function(r){var t,e="";for(t=0;t<r.parts.length;t++)e+=r.parts[t]instanceof Array?i(r.parts[t][0])+"-"+i(r.parts[t][1]):i(r.parts[t]);return"["+(r.inverted?"^":"")+e+"]"},any:function(r){return"any character"},end:function(r){return"end of input"},other:function(r){return r.description}};function o(r){return r.charCodeAt(0).toString(16).toUpperCase()}function n(r){return r.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(r){return"\\x0"+o(r)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(r){return"\\x"+o(r)}))}function i(r){return r.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(r){return"\\x0"+o(r)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(r){return"\\x"+o(r)}))}return"Expected "+function(r){var t,o,n,i=new Array(r.length);for(t=0;t<r.length;t++)i[t]=(n=r[t],e[n.type](n));if(i.sort(),i.length>0){for(t=1,o=1;t<i.length;t++)i[t-1]!==i[t]&&(i[o]=i[t],o++);i.length=o}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(r)+" but "+function(r){return r?'"'+n(r)+'"':"end of input"}(t)+" found."},r.exports={SyntaxError:o,parse:function(r,t){t=void 0!==t?t:{};var e,n={},i={kifu:J},u=J,a=j("V2",!1),s=j(".1",!1),c=j(".2",!1),l=j("$",!1),f=/^[^:]/,h=L([":"],!0,!1),d=j(":",!1),p=j("N+",!1),v=j("N-",!1),m=j("PI",!1),g=j("P",!1),A=/^[1-9]/,y=L([["1","9"]],!1,!1),k=j(" * ",!1),K=j("%",!1),I=/^[\-+_A-Z]/,C=L(["-","+","_",["A","Z"]],!1,!1),F=j("+",!1),x=j("-",!1),E=j("'",!1),b=j("T",!1),U=/^[0-9]/,M=L([["0","9"]],!1,!1),w=/^[A-Z]/,S=L([["A","Z"]],!1,!1),T=j("\r",!1),O=j("\n",!1),N=j(" ",!1),H=j(",",!1),R=/^[^\r\n]/,P=L(["\r","\n"],!0,!1),G=0,Y=[{line:1,column:1}],_=0,B=[];if("startRule"in t){if(!(t.startRule in i))throw new Error("Can't start parsing from rule \""+t.startRule+'".');u=i[t.startRule]}function j(r,t){return{type:"literal",text:r,ignoreCase:t}}function L(r,t,e){return{type:"class",parts:r,inverted:t,ignoreCase:e}}function W(t){var e,o=Y[t];if(o)return o;for(e=t-1;!Y[e];)e--;for(o={line:(o=Y[e]).line,column:o.column};e<t;)10===r.charCodeAt(e)?(o.line++,o.column=1):o.column++,e++;return Y[t]=o,o}function D(r,t){var e=W(r),o=W(t);return{start:{offset:r,line:e.line,column:e.column},end:{offset:t,line:o.line,column:o.column}}}function z(r){G<_||(G>_&&(_=G,B=[]),B.push(r))}function V(r,t,e){return new o(o.buildMessage(r,t),r,t,e)}function J(){var t;return(t=function(){var t,e,o,i;t=G,function(){var t,e,o,i,u;t=G,e=[],o=nr();for(;o!==n;)e.push(o),o=nr();e!==n?("V2"===r.substr(G,2)?(o="V2",G+=2):(o=n,z(a)),o!==n?(".1"===r.substr(G,2)?(i=".1",G+=2):(i=n,z(s)),i===n&&(".2"===r.substr(G,2)?(i=".2",G+=2):(i=n,z(c))),i===n&&(i=null),i!==n&&(u=sr())!==n?t=e=[e,o,i,u]:(G=t,t=n)):(G=t,t=n)):(G=t,t=n);return t}()!==n?((e=function(){var r,t,e;r=G,(t=$())===n&&(t=null);t!==n&&(e=function(){var r,t,e;r=G,t=[],e=Z();for(;e!==n;)t.push(e),e=Z();t!==n&&(r,t=function(r){for(var t,e={},o=0;o<r.length;o++)e[(t=r[o].k,{EVENT:"棋戦",SITE:"場所",START_TIME:"開始日時",END_TIME:"終了日時",TIME_LIMIT:"持ち時間"}[t]||t)]=r[o].v;return e}(t));return r=t}())!==n?(r,r=t={players:t,header:e}):(G=r,r=n);return r}())===n&&(e=null),e!==n&&(o=q())!==n?((i=tr())===n&&(i=null),i!==n?(t,l=o,f=i,h={header:(u=e).header,initial:l,moves:f},u&&u.players&&(u.players[0]&&(h.header["先手"]=u.players[0]),u.players[1]&&(h.header["後手"]=u.players[1])),t=h):(G=t,t=n)):(G=t,t=n)):(G=t,t=n);var u,l,f,h;return t}())===n&&(t=function(){var r,t,e,o;r=G,(t=$())===n&&(t=null);t!==n?((e=q())===n&&(e=null),e!==n&&(o=tr())!==n?(r,u={header:{},initial:e,moves:o},(i=t)&&(i[0]&&(u.header["先手"]=i[0]),i[1]&&(u.header["後手"]=i[1])),r=t=u):(G=r,r=n)):(G=r,r=n);var i,u;return r}()),t}function Z(){var t,e,o,i,u,a,s,c;for(t=G,e=[],o=nr();o!==n;)e.push(o),o=nr();if(e!==n)if(36===r.charCodeAt(G)?(o="$",G++):(o=n,z(l)),o!==n){if(i=[],f.test(r.charAt(G))?(u=r.charAt(G),G++):(u=n,z(h)),u!==n)for(;u!==n;)i.push(u),f.test(r.charAt(G))?(u=r.charAt(G),G++):(u=n,z(h));else i=n;if(i!==n)if(58===r.charCodeAt(G)?(u=":",G++):(u=n,z(d)),u!==n){for(a=[],s=cr();s!==n;)a.push(s),s=cr();a!==n&&(s=sr())!==n?(t,c=a,t=e={k:i.join(""),v:c.join("")}):(G=t,t=n)}else G=t,t=n;else G=t,t=n}else G=t,t=n;else G=t,t=n;return t}function $(){var t,e,o,i,u,a,s,c,l,f;for(t=G,e=[],o=nr();o!==n;)e.push(o),o=nr();if(e!==n){if(o=G,"N+"===r.substr(G,2)?(i="N+",G+=2):(i=n,z(p)),i!==n){for(u=[],a=cr();a!==n;)u.push(a),a=cr();u!==n&&(a=sr())!==n?(o,o=i=u):(G=o,o=n)}else G=o,o=n;if(o===n&&(o=null),o!==n){for(i=[],u=nr();u!==n;)i.push(u),u=nr();if(i!==n){if(u=G,"N-"===r.substr(G,2)?(a="N-",G+=2):(a=n,z(v)),a!==n){for(s=[],c=cr();c!==n;)s.push(c),c=cr();s!==n&&(c=sr())!==n?(u,u=a=s):(G=u,u=n)}else G=u,u=n;u===n&&(u=null),u!==n?(t,f=u,t=e=[(l=o)?l.join(""):null,f?f.join(""):null]):(G=t,t=n)}else G=t,t=n}else G=t,t=n}else G=t,t=n;return t}function q(){var t,e,o,i,u,a,s,c,l;for(t=G,e=[],o=nr();o!==n;)e.push(o),o=nr();if(e!==n)if((o=function(){var t,e,o,i;t=G,"PI"===r.substr(G,2)?(e="PI",G+=2):(e=n,z(m));if(e!==n){for(o=[],i=ar();i!==n;)o.push(i),i=ar();o!==n&&(i=sr())!==n?(t,e=function(r){for(var t={preset:"OTHER",data:{board:[[{color:1,kind:"KY"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KY"}],[{color:1,kind:"KE"},{color:1,kind:"KA"},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{color:0,kind:"HI"},{color:0,kind:"KE"}],[{color:1,kind:"GI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"GI"}],[{color:1,kind:"KI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KI"}],[{color:1,kind:"OU"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"OU"}],[{color:1,kind:"KI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KI"}],[{color:1,kind:"GI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"GI"}],[{color:1,kind:"KE"},{color:1,kind:"HI"},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{color:0,kind:"KA"},{color:0,kind:"KE"}],[{color:1,kind:"KY"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KY"}]]}},e=0;e<r.length;e++)t.data.board[r[e].xy.x-1][r[e].xy.y-1]={};return t}(o),t=e):(G=t,t=n)}else G=t,t=n;return t}())===n&&(o=function(){var r,t,e;if(r=G,t=[],(e=Q())!==n)for(;e!==n;)t.push(e),e=Q();else t=n;t!==n&&(r,t=function(r){for(var t=[],e=0;e<9;e++){for(var o=[],n=0;n<9;n++)o.push(r[n][8-e]);t.push(o)}return{preset:"OTHER",data:{board:t}}}(t));return r=t}())===n&&(o=G,(i="")!==n&&(o,i="NO"),o=i),o!==n)if((i=function(){var r,t,e;r=G,t=[],e=rr();for(;e!==n;)t.push(e),e=rr();t!==n&&(r,t=function(r){for(var t=[],e=[{FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0},{FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0}],o={FU:18,KY:4,KE:4,GI:4,KI:4,KA:2,HI:2},n=0;n<9;n++){for(var i=[],u=0;u<9;u++)i.push({});t.push(i)}r:for(n=0;n<r.length;n++)for(u=0;u<r[n].pieces.length;u++){var a=r[n].pieces[u];if(0==a.xy.x){if("AL"==a.piece){e[r[n].teban]=o;break r}e[r[n].teban][a.piece]++}else t[a.xy.x-1][a.xy.y-1]={color:r[n].teban,kind:a.piece};"OU"!=a.piece&&o[a.piece]--}return{preset:"OTHER",data:{board:t,hands:e}}}(t));return r=t}())!==n){for(u=[],a=nr();a!==n;)u.push(a),a=nr();u!==n&&(a=or())!==n&&sr()!==n?(t,c=i,l=a,"NO"==(s=o)?s=c:s.data.hands=c.data.hands,s.data.color=l,t=e=s):(G=t,t=n)}else G=t,t=n;else G=t,t=n;else G=t,t=n;return t}function Q(){var t,e,o,i,u;if(t=G,80===r.charCodeAt(G)?(e="P",G++):(e=n,z(g)),e!==n)if(A.test(r.charAt(G))?(o=r.charAt(G),G++):(o=n,z(y)),o!==n){if(i=[],(u=X())!==n)for(;u!==n;)i.push(u),u=X();else i=n;i!==n&&(u=sr())!==n?(t,t=e=i):(G=t,t=n)}else G=t,t=n;else G=t,t=n;return t}function X(){var t,e,o;return t=G,(e=or())!==n&&(o=ur())!==n?(t,t=e={color:e,kind:o}):(G=t,t=n),t===n&&(t=G," * "===r.substr(G,3)?(e=" * ",G+=3):(e=n,z(k)),e!==n&&(t,e={}),t=e),t}function rr(){var t,e,o,i,u;if(t=G,80===r.charCodeAt(G)?(e="P",G++):(e=n,z(g)),e!==n)if((o=or())!==n){if(i=[],(u=ar())!==n)for(;u!==n;)i.push(u),u=ar();else i=n;i!==n&&(u=sr())!==n?(t,t=e={teban:o,pieces:i}):(G=t,t=n)}else G=t,t=n;else G=t,t=n;return t}function tr(){var r,t,e,o,i,u,a;if(r=G,(t=function(){var r,t,e;r=G,t=[],e=nr();for(;e!==n;)t.push(e),e=nr();t!==n&&(r,t=(o=t).length>0?{comments:o}:{});var o;return r=t}())!==n){for(e=[],o=er();o!==n;)e.push(o),o=er();if(e!==n){for(o=[],i=nr();i!==n;)o.push(i),i=nr();o!==n?(r,u=t,(a=e).unshift(u),r=t=a):(G=r,r=n)}else G=r,r=n}else G=r,r=n;return r}function er(){var t,e,o,i,u,a;if(t=G,(e=function(){var r,t,e,o;r=G,or()!==n&&(t=ir())!==n&&(e=ir())!==n&&(o=ur())!==n&&sr()!==n?(r,u={to:e,piece:o},0!=(i=t).x&&(u.from=i),r=u):(G=r,r=n);var i,u;return r}())===n&&(e=function(){var t,e,o,i;t=G,37===r.charCodeAt(G)?(e="%",G++):(e=n,z(K));if(e!==n){if(o=[],I.test(r.charAt(G))?(i=r.charAt(G),G++):(i=n,z(C)),i!==n)for(;i!==n;)o.push(i),I.test(r.charAt(G))?(i=r.charAt(G),G++):(i=n,z(C));else o=n;o!==n&&(i=sr())!==n?(t,e={special:o.join("")},t=e):(G=t,t=n)}else G=t,t=n;return t}()),e!==n){for(o=[],i=nr();i!==n;)o.push(i),i=nr();if(o!==n)if((i=function(){var t,e,o,i;t=G,84===r.charCodeAt(G)?(e="T",G++):(e=n,z(b));if(e!==n){for(o=[],U.test(r.charAt(G))?(i=r.charAt(G),G++):(i=n,z(M));i!==n;)o.push(i),U.test(r.charAt(G))?(i=r.charAt(G),G++):(i=n,z(M));o!==n&&(i=sr())!==n?(t,e={now:lr(parseInt(o.join("")))},t=e):(G=t,t=n)}else G=t,t=n;return t}())===n&&(i=null),i!==n){for(u=[],a=nr();a!==n;)u.push(a),a=nr();u!==n?(t,t=e=function(r,t,e,o){var n={};const i=t.concat(o);return i.length>0&&(n.comments=i),e&&(n.time=e),r.special?n.special=r.special:n.move=r,n}(e,o,i,u)):(G=t,t=n)}else G=t,t=n;else G=t,t=n}else G=t,t=n;return t}function or(){var t,e;return t=G,43===r.charCodeAt(G)?(e="+",G++):(e=n,z(F)),e!==n&&(t,e=0),(t=e)===n&&(t=G,45===r.charCodeAt(G)?(e="-",G++):(e=n,z(x)),e!==n&&(t,e=1),t=e),t}function nr(){var t,e,o,i;if(t=G,39===r.charCodeAt(G)?(e="'",G++):(e=n,z(E)),e!==n){for(o=[],i=cr();i!==n;)o.push(i),i=cr();o!==n&&(i=sr())!==n?(t,t=e=o.join("")):(G=t,t=n)}else G=t,t=n;return t}function ir(){var t,e,o,i;return t=G,U.test(r.charAt(G))?(e=r.charAt(G),G++):(e=n,z(M)),e!==n?(U.test(r.charAt(G))?(o=r.charAt(G),G++):(o=n,z(M)),o!==n?(t,i=o,t=e={x:parseInt(e),y:parseInt(i)}):(G=t,t=n)):(G=t,t=n),t}function ur(){var t,e,o;return t=G,w.test(r.charAt(G))?(e=r.charAt(G),G++):(e=n,z(S)),e!==n?(w.test(r.charAt(G))?(o=r.charAt(G),G++):(o=n,z(S)),o!==n?(t,t=e=e+o):(G=t,t=n)):(G=t,t=n),t}function ar(){var r,t,e;return r=G,(t=ir())!==n&&(e=ur())!==n?(r,r=t={xy:t,piece:e}):(G=r,r=n),r}function sr(){var t,e,o;if(t=G,13===r.charCodeAt(G)?(e="\r",G++):(e=n,z(T)),e===n&&(e=null),e!==n?(10===r.charCodeAt(G)?(o="\n",G++):(o=n,z(O)),o!==n?t=e=[e,o]:(G=t,t=n)):(G=t,t=n),t===n){for(t=G,e=[],32===r.charCodeAt(G)?(o=" ",G++):(o=n,z(N));o!==n;)e.push(o),32===r.charCodeAt(G)?(o=" ",G++):(o=n,z(N));e!==n?(44===r.charCodeAt(G)?(o=",",G++):(o=n,z(H)),o!==n?t=e=[e,o]:(G=t,t=n)):(G=t,t=n)}return t}function cr(){var t;return R.test(r.charAt(G))?(t=r.charAt(G),G++):(t=n,z(P)),t}function lr(r){var t=r%60;return{m:(r-t)/60,s:t}}if((e=u())!==n&&G===r.length)return e;throw e!==n&&G<r.length&&z({type:"end"}),V(B,_<r.length?r.charAt(_):null,_<r.length?D(_,_+1):D(_,_))}}},function(r,t,e){"use strict";function o(r,t,e,n){this.message=r,this.expected=t,this.found=e,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,o)}!function(r,t){function e(){this.constructor=r}e.prototype=t.prototype,r.prototype=new e}(o,Error),o.buildMessage=function(r,t){var e={literal:function(r){return'"'+n(r.text)+'"'},class:function(r){var t,e="";for(t=0;t<r.parts.length;t++)e+=r.parts[t]instanceof Array?i(r.parts[t][0])+"-"+i(r.parts[t][1]):i(r.parts[t]);return"["+(r.inverted?"^":"")+e+"]"},any:function(r){return"any character"},end:function(r){return"end of input"},other:function(r){return r.description}};function o(r){return r.charCodeAt(0).toString(16).toUpperCase()}function n(r){return r.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(r){return"\\x0"+o(r)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(r){return"\\x"+o(r)}))}function i(r){return r.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(r){return"\\x0"+o(r)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(r){return"\\x"+o(r)}))}return"Expected "+function(r){var t,o,n,i=new Array(r.length);for(t=0;t<r.length;t++)i[t]=(n=r[t],e[n.type](n));if(i.sort(),i.length>0){for(t=1,o=1;t<i.length;t++)i[t-1]!==i[t]&&(i[o]=i[t],o++);i.length=o}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(r)+" but "+function(r){return r?'"'+n(r)+'"':"end of input"}(t)+" found."},r.exports={SyntaxError:o,parse:function(r,t){t=void 0!==t?t:{};var e,n={},i={kifu:kr},u=kr,a=/^[^\uFF1A\r\n]/,s=vr(["：","\r","\n"],!0,!1),c=pr("：",!1),l=/^[\u5148\u5F8C\u4E0A\u4E0B]/,f=vr(["先","後","上","下"],!1,!1),h=pr("手番",!1),d=pr(" ",!1),p=pr("+",!1),v=pr("|",!1),m=pr(" ・",!1),g=pr("^",!1),A=pr("v",!1),y=pr("V",!1),k=pr("&",!1),K=/^[\u25B2\u25B3]/,I=vr(["▲","△"],!1,!1),C=pr("成",!1),F=pr("不成",!1),x=pr("打",!1),E=pr("同",!1),b=pr("　",!1),U=/^[\u6B69\u9999\u6842\u9280\u91D1\u89D2\u98DB\u738B\u7389\u3068\u674F\u572D\u5168\u99AC\u7ADC\u9F8D]/,M=vr(["歩","香","桂","銀","金","角","飛","王","玉","と","杏","圭","全","馬","竜","龍"],!1,!1),w=/^[\u5DE6\u76F4\u53F3]/,S=vr(["左","直","右"],!1,!1),T=/^[\u4E0A\u5BC4\u5F15]/,O=vr(["上","寄","引"],!1,!1),N=/^[\uFF11\uFF12\uFF13\uFF14\uFF15\uFF16\uFF17\uFF18\uFF19]/,H=vr(["１","２","３","４","５","６","７","８","９"],!1,!1),R=/^[\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D]/,P=vr(["一","二","三","四","五","六","七","八","九"],!1,!1),G=pr("*",!1),Y=pr("まで",!1),_=/^[0-9]/,B=vr([["0","9"]],!1,!1),j=pr("手",!1),L=pr("で",!1),W=pr("手の",!1),D=pr("勝ち",!1),z=pr("反則",!1),V=pr("負け",!1),J=function(r,t){return t},Z=pr("で時間切れにより",!1),$=pr("手の勝ち",!1),q=pr("で中断",!1),Q=pr("で持将棋",!1),X=pr("で千日手",!1),rr=pr("詰",!1),tr=pr("み",!1),er=pr("で不詰",!1),or=pr("変化：",!1),nr=pr("#",!1),ir=pr("\t",!1),ur=pr("\n",!1),ar=pr("\r",!1),sr=/^[^\r\n]/,cr=vr(["\r","\n"],!0,!1),lr=0,fr=[{line:1,column:1}],hr=0,dr=[];if("startRule"in t){if(!(t.startRule in i))throw new Error("Can't start parsing from rule \""+t.startRule+'".');u=i[t.startRule]}function pr(r,t){return{type:"literal",text:r,ignoreCase:t}}function vr(r,t,e){return{type:"class",parts:r,inverted:t,ignoreCase:e}}function mr(t){var e,o=fr[t];if(o)return o;for(e=t-1;!fr[e];)e--;for(o={line:(o=fr[e]).line,column:o.column};e<t;)10===r.charCodeAt(e)?(o.line++,o.column=1):o.column++,e++;return fr[t]=o,o}function gr(r,t){var e=mr(r),o=mr(t);return{start:{offset:r,line:e.line,column:e.column},end:{offset:t,line:o.line,column:o.column}}}function Ar(r){lr<hr||(lr>hr&&(hr=lr,dr=[]),dr.push(r))}function yr(r,t,e){return new o(o.buildMessage(r,t),r,t,e)}function kr(){var t,e,o,i,u,a,s;for(t=lr,e=[],o=Kr();o!==n;)e.push(o),o=Kr();if(e!==n)if((o=function(){var t,e,o,i,u,a,s,c;t=lr,e=lr,32===r.charCodeAt(lr)?(o=" ",lr++):(o=n,Ar(d));if(o!==n){for(i=[],u=Hr();u!==n;)i.push(u),u=Hr();i!==n&&(u=Sr())!==n?e=o=[o,i,u]:(lr=e,e=n)}else lr=e,e=n;e===n&&(e=null);if(e!==n){if(o=lr,43===r.charCodeAt(lr)?(i="+",lr++):(i=n,Ar(p)),i!==n){for(u=[],a=Hr();a!==n;)u.push(a),a=Hr();u!==n&&(a=Sr())!==n?o=i=[i,u,a]:(lr=o,o=n)}else lr=o,o=n;if(o===n&&(o=null),o!==n){if(i=[],(u=Ir())!==n)for(;u!==n;)i.push(u),u=Ir();else i=n;if(i!==n){if(u=lr,43===r.charCodeAt(lr)?(a="+",lr++):(a=n,Ar(p)),a!==n){for(s=[],c=Hr();c!==n;)s.push(c),c=Hr();s!==n&&(c=Sr())!==n?u=a=[a,s,c]:(lr=u,u=n)}else lr=u,u=n;u===n&&(u=null),u!==n?(t,e=function(r){for(var t=[],e=0;e<9;e++){for(var o=[],n=0;n<9;n++)o.push(r[n][8-e]);t.push(o)}return{preset:"OTHER",data:{board:t}}}(i),t=e):(lr=t,t=n)}else lr=t,t=n}else lr=t,t=n}else lr=t,t=n;return t}())===n&&(o=null),o!==n){for(i=[],u=Kr();u!==n;)i.push(u),u=Kr();if(i!==n)if((u=Fr())!==n){for(a=[],s=Mr();s!==n;)a.push(s),s=Mr();a!==n?(t,t=e=function(r,t,e,o,n){for(var i={header:{},moves:o},u=0;u<r.length;u++)i.header[r[u].k]=r[u].v;for(u=0;u<e.length;u++)i.header[e[u].k]=e[u].v;if(t)i.initial=t;else if(i.header["手合割"]){var a=function(r){return{"平手":"HIRATE","香落ち":"KY","右香落ち":"KY_R","角落ち":"KA","飛車落ち":"HI","飛香落ち":"HIKY","二枚落ち":"2","三枚落ち":"3","四枚落ち":"4","五枚落ち":"5","左五枚落ち":"5_L","六枚落ち":"6","八枚落ち":"8","十枚落ち":"10","その他":"OTHER"}[r.replace(/\s/g,"")]}(i.header["手合割"]);"OTHER"!=a&&(i.initial={preset:a})}i.initial&&i.initial.data&&(i.header["手番"]?(i.initial.data.color="下先".indexOf(i.header["手番"])>=0?0:1,delete i.header["手番"]):i.initial.data.color=0,i.initial.data.hands=[Gr(i.header["先手の持駒"]||i.header["下手の持駒"]),Gr(i.header["後手の持駒"]||i.header["上手の持駒"])],delete i.header["先手の持駒"],delete i.header["下手の持駒"],delete i.header["後手の持駒"],delete i.header["上手の持駒"]);var s=[{te:0,moves:o}];for(u=0;u<n.length;u++){for(var c=n[u],l=s.pop();l.te>=c.te;)l=s.pop();var f=l.moves[c.te-l.te];f.forks=f.forks||[],f.forks.push(c.moves),s.push(l),s.push(c)}return i}(e,o,i,u,a)):(lr=t,t=n)}else lr=t,t=n;else lr=t,t=n}else lr=t,t=n;else lr=t,t=n;return t}function Kr(){var t,e,o,i,u,d,p;if(t=lr,e=[],a.test(r.charAt(lr))?(o=r.charAt(lr),lr++):(o=n,Ar(s)),o!==n)for(;o!==n;)e.push(o),a.test(r.charAt(lr))?(o=r.charAt(lr),lr++):(o=n,Ar(s));else e=n;if(e!==n)if(65306===r.charCodeAt(lr)?(o="：",lr++):(o=n,Ar(c)),o!==n){for(i=[],u=Hr();u!==n;)i.push(u),u=Hr();if(i!==n){if(u=[],(d=Sr())!==n)for(;d!==n;)u.push(d),d=Sr();else u=n;u!==n?(t,p=i,t=e={k:e.join(""),v:p.join("")}):(lr=t,t=n)}else lr=t,t=n}else lr=t,t=n;else lr=t,t=n;return t===n&&(t=lr,l.test(r.charAt(lr))?(e=r.charAt(lr),lr++):(e=n,Ar(f)),e!==n?("手番"===r.substr(lr,2)?(o="手番",lr+=2):(o=n,Ar(h)),o!==n&&(i=Sr())!==n?(t,t=e={k:"手番",v:e}):(lr=t,t=n)):(lr=t,t=n)),t}function Ir(){var t,e,o,i,u,a;if(t=lr,124===r.charCodeAt(lr)?(e="|",lr++):(e=n,Ar(v)),e!==n){if(o=[],(i=Cr())!==n)for(;i!==n;)o.push(i),i=Cr();else o=n;if(o!==n)if(124===r.charCodeAt(lr)?(i="|",lr++):(i=n,Ar(v)),i!==n){if(u=[],(a=Hr())!==n)for(;a!==n;)u.push(a),a=Hr();else u=n;u!==n&&(a=Sr())!==n?(t,t=e=o):(lr=t,t=n)}else lr=t,t=n;else lr=t,t=n}else lr=t,t=n;return t}function Cr(){var t,e,o;return t=lr,(e=function(){var t,e;t=lr,32===r.charCodeAt(lr)?(e=" ",lr++):(e=n,Ar(d));e===n&&(43===r.charCodeAt(lr)?(e="+",lr++):(e=n,Ar(p)),e===n&&(94===r.charCodeAt(lr)?(e="^",lr++):(e=n,Ar(g))));e!==n&&(t,e=0);(t=e)===n&&(t=lr,118===r.charCodeAt(lr)?(e="v",lr++):(e=n,Ar(A)),e===n&&(86===r.charCodeAt(lr)?(e="V",lr++):(e=n,Ar(y))),e!==n&&(t,e=1),t=e);return t}())!==n&&(o=br())!==n?(t,t=e={color:e,kind:o}):(lr=t,t=n),t===n&&(t=lr," ・"===r.substr(lr,2)?(e=" ・",lr+=2):(e=n,Ar(m)),e!==n&&(t,e={}),t=e),t}function Fr(){var t,e,o,i,u,a,s;if(t=lr,(e=function(){var r,t,e;r=lr,t=[],e=Ur();for(;e!==n;)t.push(e),e=Ur();t!==n?((e=Er())===n&&(e=null),e!==n?(r,t=0==(o=t).length?{}:{comments:o},r=t):(lr=r,r=n)):(lr=r,r=n);var o;return r}())!==n){for(o=[],i=xr();i!==n;)o.push(i),i=xr();o!==n?((i=function(){var t,e,o,i,u,a,s,c,l,f,h,d;t=lr,"まで"===r.substr(lr,2)?(e="まで",lr+=2):(e=n,Ar(Y));if(e!==n){if(o=[],_.test(r.charAt(lr))?(i=r.charAt(lr),lr++):(i=n,Ar(B)),i!==n)for(;i!==n;)o.push(i),_.test(r.charAt(lr))?(i=r.charAt(lr),lr++):(i=n,Ar(B));else o=n;o!==n?(25163===r.charCodeAt(lr)?(i="手",lr++):(i=n,Ar(j)),i!==n?(u=lr,12391===r.charCodeAt(lr)?(a="で",lr++):(a=n,Ar(L)),a!==n&&(s=wr())!==n?("手の"===r.substr(lr,2)?(c="手の",lr+=2):(c=n,Ar(W)),c!==n?(l=lr,"勝ち"===r.substr(lr,2)?(f="勝ち",lr+=2):(f=n,Ar(D)),f!==n&&(l,f="TORYO"),(l=f)===n&&(l=lr,"反則"===r.substr(lr,2)?(f="反則",lr+=2):(f=n,Ar(z)),f!==n?(h=lr,"勝ち"===r.substr(lr,2)?(d="勝ち",lr+=2):(d=n,Ar(D)),d!==n&&(h,d="ILLEGAL_ACTION"),(h=d)===n&&(h=lr,"負け"===r.substr(lr,2)?(d="負け",lr+=2):(d=n,Ar(V)),d!==n&&(h,d="ILLEGAL_MOVE"),h=d),h!==n?(l,f=J(0,h),l=f):(lr=l,l=n)):(lr=l,l=n)),l!==n?(u,a=J(0,l),u=a):(lr=u,u=n)):(lr=u,u=n)):(lr=u,u=n),u===n&&(u=lr,"で時間切れにより"===r.substr(lr,8)?(a="で時間切れにより",lr+=8):(a=n,Ar(Z)),a!==n&&(s=wr())!==n?("手の勝ち"===r.substr(lr,4)?(c="手の勝ち",lr+=4):(c=n,Ar($)),c!==n?(u,u=a="TIME_UP"):(lr=u,u=n)):(lr=u,u=n),u===n&&(u=lr,"で中断"===r.substr(lr,3)?(a="で中断",lr+=3):(a=n,Ar(q)),a!==n&&(u,a="CHUDAN"),(u=a)===n&&(u=lr,"で持将棋"===r.substr(lr,4)?(a="で持将棋",lr+=4):(a=n,Ar(Q)),a!==n&&(u,a="JISHOGI"),(u=a)===n&&(u=lr,"で千日手"===r.substr(lr,4)?(a="で千日手",lr+=4):(a=n,Ar(X)),a!==n&&(u,a="SENNICHITE"),(u=a)===n&&(u=lr,12391===r.charCodeAt(lr)?(a="で",lr++):(a=n,Ar(L)),a===n&&(a=null),a!==n?(35440===r.charCodeAt(lr)?(s="詰",lr++):(s=n,Ar(rr)),s!==n?(12415===r.charCodeAt(lr)?(c="み",lr++):(c=n,Ar(tr)),c===n&&(c=null),c!==n?(u,u=a="TSUMI"):(lr=u,u=n)):(lr=u,u=n)):(lr=u,u=n),u===n&&(u=lr,"で不詰"===r.substr(lr,3)?(a="で不詰",lr+=3):(a=n,Ar(er)),a!==n&&(u,a="FUZUMI"),u=a)))))),u!==n&&(a=Sr())!==n?(t,t=e=u):(lr=t,t=n)):(lr=t,t=n)):(lr=t,t=n)}else lr=t,t=n;return t}())===n&&(i=null),i!==n?(t,u=e,s=i,(a=o).unshift(u),s&&!a[a.length-1].special&&a.push({special:s}),t=e=a):(lr=t,t=n)):(lr=t,t=n)}else lr=t,t=n;return t}function xr(){var t,e,o,i,u,a,s,c;if(t=lr,(e=function(){var t,e,o,i,u;t=lr,K.test(r.charAt(lr))?(e=r.charAt(lr),lr++):(e=n,Ar(I));if(e!==n)if((o=function(){var t,e,o,i,u,a,s;t=lr,(e=function(){var t,e,o;t=lr,(e=function(){var t,e;t=lr,N.test(r.charAt(lr))?(e=r.charAt(lr),lr++):(e=n,Ar(H));e!==n&&(t,e="０１２３４５６７８９".indexOf(e));return t=e}())!==n&&(o=function(){var t,e;t=lr,R.test(r.charAt(lr))?(e=r.charAt(lr),lr++):(e=n,Ar(P));e!==n&&(t,e="〇一二三四五六七八九".indexOf(e));return t=e}())!==n?(t,t=e={x:e,y:o}):(lr=t,t=n);t===n&&(t=lr,21516===r.charCodeAt(lr)?(e="同",lr++):(e=n,Ar(E)),e!==n?(12288===r.charCodeAt(lr)?(o="　",lr++):(o=n,Ar(b)),o===n&&(o=null),o!==n?(t,t=e={same:!0}):(lr=t,t=n)):(lr=t,t=n));return t}())!==n&&(o=br())!==n?((i=function(){var t;w.test(r.charAt(lr))?(t=r.charAt(lr),lr++):(t=n,Ar(S));return t}())===n&&(i=null),i!==n?((u=function(){var t;T.test(r.charAt(lr))?(t=r.charAt(lr),lr++):(t=n,Ar(O));return t}())===n&&(u=null),u!==n?(25104===r.charCodeAt(lr)?(a="成",lr++):(a=n,Ar(C)),a===n&&("不成"===r.substr(lr,2)?(a="不成",lr+=2):(a=n,Ar(F))),a===n&&(a=null),a!==n?(25171===r.charCodeAt(lr)?(s="打",lr++):(s=n,Ar(x)),s===n&&(s=null),s!==n?(t,e=function(r,t,e,o,n,i){var u={piece:t};if(r.same?u.same=!0:u.to=r,n&&(u.promote="成"==n),i)u.relative="H";else{var a=({"左":"L","直":"C","右":"R"}[e]||"")+function(r){return{"上":"U","寄":"M","引":"D"}[r]||""}(o);""!=a&&(u.relative=a)}return u}(e,o,i,u,a,s),t=e):(lr=t,t=n)):(lr=t,t=n)):(lr=t,t=n)):(lr=t,t=n)):(lr=t,t=n);return t}())!==n){for(i=[],(u=Sr())===n&&(32===r.charCodeAt(lr)?(u=" ",lr++):(u=n,Ar(d)));u!==n;)i.push(u),(u=Sr())===n&&(32===r.charCodeAt(lr)?(u=" ",lr++):(u=n,Ar(d)));i!==n?(t,t=e=o):(lr=t,t=n)}else lr=t,t=n;else lr=t,t=n;return t}())!==n){for(o=[],i=Ur();i!==n;)o.push(i),i=Ur();if(o!==n)if((i=Er())===n&&(i=null),i!==n){for(u=[],(a=Sr())===n&&(32===r.charCodeAt(lr)?(a=" ",lr++):(a=n,Ar(d)));a!==n;)u.push(a),(a=Sr())===n&&(32===r.charCodeAt(lr)?(a=" ",lr++):(a=n,Ar(d)));u!==n?(t,c={move:e},(s=o).length>0&&(c.comments=s),t=e=c):(lr=t,t=n)}else lr=t,t=n;else lr=t,t=n}else lr=t,t=n;return t}function Er(){var t,e,o,i;if(t=lr,38===r.charCodeAt(lr)?(e="&",lr++):(e=n,Ar(k)),e!==n){for(o=[],i=Hr();i!==n;)o.push(i),i=Hr();o!==n&&(i=Sr())!==n?t=e=[e,o,i]:(lr=t,t=n)}else lr=t,t=n;return t}function br(){var t,e,o;return t=lr,25104===r.charCodeAt(lr)?(e="成",lr++):(e=n,Ar(C)),e===n&&(e=null),e!==n?(U.test(r.charAt(lr))?(o=r.charAt(lr),lr++):(o=n,Ar(M)),o!==n?(t,t=e=Pr((e||"")+o)):(lr=t,t=n)):(lr=t,t=n),t}function Ur(){var t,e,o,i;if(t=lr,42===r.charCodeAt(lr)?(e="*",lr++):(e=n,Ar(G)),e!==n){for(o=[],i=Hr();i!==n;)o.push(i),i=Hr();o!==n&&(i=Sr())!==n?(t,t=e=o.join("")):(lr=t,t=n)}else lr=t,t=n;return t}function Mr(){var t,e,o,i,u,a,s;if(t=lr,"変化："===r.substr(lr,3)?(e="変化：",lr+=3):(e=n,Ar(or)),e!==n){for(o=[],32===r.charCodeAt(lr)?(i=" ",lr++):(i=n,Ar(d));i!==n;)o.push(i),32===r.charCodeAt(lr)?(i=" ",lr++):(i=n,Ar(d));if(o!==n){if(i=[],_.test(r.charAt(lr))?(u=r.charAt(lr),lr++):(u=n,Ar(B)),u!==n)for(;u!==n;)i.push(u),_.test(r.charAt(lr))?(u=r.charAt(lr),lr++):(u=n,Ar(B));else i=n;i!==n?(25163===r.charCodeAt(lr)?(u="手",lr++):(u=n,Ar(j)),u!==n&&Sr()!==n&&(a=Fr())!==n?(t,s=a,t=e={te:parseInt(i.join("")),moves:s.slice(1)}):(lr=t,t=n)):(lr=t,t=n)}else lr=t,t=n}else lr=t,t=n;return t}function wr(){var t;return l.test(r.charAt(lr))?(t=r.charAt(lr),lr++):(t=n,Ar(f)),t}function Sr(){var r,t,e,o;if(r=lr,t=[],(e=Nr())!==n)for(;e!==n;)t.push(e),e=Nr();else t=n;if(t!==n){for(e=[],o=Tr();o!==n;)e.push(o),o=Tr();e!==n?r=t=[t,e]:(lr=r,r=n)}else lr=r,r=n;return r}function Tr(){var t,e,o,i;if(t=lr,35===r.charCodeAt(lr)?(e="#",lr++):(e=n,Ar(nr)),e!==n){for(o=[],i=Hr();i!==n;)o.push(i),i=Hr();o!==n&&(i=Nr())!==n?t=e=[e,o,i]:(lr=t,t=n)}else lr=t,t=n;return t}function Or(){var t;return 32===r.charCodeAt(lr)?(t=" ",lr++):(t=n,Ar(d)),t===n&&(9===r.charCodeAt(lr)?(t="\t",lr++):(t=n,Ar(ir))),t}function Nr(){var t,e,o,i,u;for(t=lr,e=[],o=Or();o!==n;)e.push(o),o=Or();return e!==n?(10===r.charCodeAt(lr)?(o="\n",lr++):(o=n,Ar(ur)),o===n&&(o=lr,13===r.charCodeAt(lr)?(i="\r",lr++):(i=n,Ar(ar)),i!==n?(10===r.charCodeAt(lr)?(u="\n",lr++):(u=n,Ar(ur)),u===n&&(u=null),u!==n?o=i=[i,u]:(lr=o,o=n)):(lr=o,o=n)),o!==n?t=e=[e,o]:(lr=t,t=n)):(lr=t,t=n),t}function Hr(){var t;return sr.test(r.charAt(lr))?(t=r.charAt(lr),lr++):(t=n,Ar(cr)),t}function Rr(r){switch(r.length){case 1:return"〇一二三四五六七八九十".indexOf(r);case 2:return"〇一二三四五六七八九十".indexOf(r[1])+10;default:throw"21以上の数値に対応していません"}}function Pr(r){return"成"==r[0]?{"香":"NY","桂":"NK","銀":"NG"}[r[1]]:{"歩":"FU","香":"KY","桂":"KE","銀":"GI","金":"KI","角":"KA","飛":"HI","玉":"OU","王":"OU","と":"TO","杏":"NY","圭":"NK","全":"NG","馬":"UM","竜":"RY","龍":"RY"}[r]}function Gr(r){var t=r.replace(/　$/,"").split("　"),e={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0};if(""==r)return e;for(var o=0;o<t.length;o++)e[Pr(t[o][0])]=1==t[o].length?1:Rr(t[o].slice(1));return e}if((e=u())!==n&&lr===r.length)return e;throw e!==n&&lr<r.length&&Ar({type:"end"}),yr(dr,hr<r.length?r.charAt(hr):null,hr<r.length?gr(hr,hr+1):gr(hr,hr))}}},function(r,t,e){"use strict";function o(r,t,e,n){this.message=r,this.expected=t,this.found=e,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,o)}!function(r,t){function e(){this.constructor=r}e.prototype=t.prototype,r.prototype=new e}(o,Error),o.buildMessage=function(r,t){var e={literal:function(r){return'"'+n(r.text)+'"'},class:function(r){var t,e="";for(t=0;t<r.parts.length;t++)e+=r.parts[t]instanceof Array?i(r.parts[t][0])+"-"+i(r.parts[t][1]):i(r.parts[t]);return"["+(r.inverted?"^":"")+e+"]"},any:function(r){return"any character"},end:function(r){return"end of input"},other:function(r){return r.description}};function o(r){return r.charCodeAt(0).toString(16).toUpperCase()}function n(r){return r.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(r){return"\\x0"+o(r)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(r){return"\\x"+o(r)}))}function i(r){return r.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(r){return"\\x0"+o(r)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(r){return"\\x"+o(r)}))}return"Expected "+function(r){var t,o,n,i=new Array(r.length);for(t=0;t<r.length;t++)i[t]=(n=r[t],e[n.type](n));if(i.sort(),i.length>0){for(t=1,o=1;t<i.length;t++)i[t-1]!==i[t]&&(i[o]=i[t],o++);i.length=o}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(r)+" but "+function(r){return r?'"'+n(r)+'"':"end of input"}(t)+" found."},r.exports={SyntaxError:o,parse:function(r,t){t=void 0!==t?t:{};var e,n={},i={kifu:xr},u=xr,a=/^[^\uFF1A\r\n]/,s=kr(["：","\r","\n"],!0,!1),c=yr("：",!1),l=yr("手番",!1),f=yr("盤面回転",!1),h=/^[\u5148\u5F8C\u4E0A\u4E0B]/,d=kr(["先","後","上","下"],!1,!1),p=yr(" ",!1),v=yr("+",!1),m=yr("|",!1),g=yr(" ・",!1),A=yr("^",!1),y=yr("v",!1),k=yr("V",!1),K=yr("手数----指手--",!1),I=yr("-------消費時間--",!1),C=yr("&",!1),F=/^[^\r\n ]/,x=kr(["\r","\n"," "],!0,!1),E=/^[0-9]/,b=kr([["0","9"]],!1,!1),U=yr("成",!1),M=yr("同",!1),w=yr("　",!1),S=/^[\uFF11\uFF12\uFF13\uFF14\uFF15\uFF16\uFF17\uFF18\uFF19]/,T=kr(["１","２","３","４","５","６","７","８","９"],!1,!1),O=/^[\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D]/,N=kr(["一","二","三","四","五","六","七","八","九"],!1,!1),H=/^[\u6B69\u9999\u6842\u9280\u91D1\u89D2\u98DB\u738B\u7389\u3068\u674F\u572D\u5168\u99AC\u7ADC\u9F8D]/,R=kr(["歩","香","桂","銀","金","角","飛","王","玉","と","杏","圭","全","馬","竜","龍"],!1,!1),P=yr("打",!1),G=yr("(",!1),Y=/^[1-9]/,_=kr([["1","9"]],!1,!1),B=yr(")",!1),j=yr("/",!1),L=yr(":",!1),W=yr("*",!1),D=yr("まで",!1),z=yr("手",!1),V=yr("で",!1),J=yr("手の",!1),Z=yr("勝ち",!1),$=yr("反則",!1),q=yr("負け",!1),Q=function(r,t){return t},X=yr("で時間切れにより",!1),rr=yr("手の勝ち",!1),tr=yr("で中断",!1),er=yr("で封じ手",!1),or=yr("で持将棋",!1),nr=yr("で千日手",!1),ir=yr("詰",!1),ur=yr("み",!1),ar=yr("で不詰",!1),sr=yr("変化：",!1),cr=yr("#",!1),lr=yr("\t",!1),fr=yr("\n",!1),hr=yr("\r",!1),dr=/^[^\r\n]/,pr=kr(["\r","\n"],!0,!1),vr=0,mr=[{line:1,column:1}],gr=0,Ar=[];if("startRule"in t){if(!(t.startRule in i))throw new Error("Can't start parsing from rule \""+t.startRule+'".');u=i[t.startRule]}function yr(r,t){return{type:"literal",text:r,ignoreCase:t}}function kr(r,t,e){return{type:"class",parts:r,inverted:t,ignoreCase:e}}function Kr(t){var e,o=mr[t];if(o)return o;for(e=t-1;!mr[e];)e--;for(o={line:(o=mr[e]).line,column:o.column};e<t;)10===r.charCodeAt(e)?(o.line++,o.column=1):o.column++,e++;return mr[t]=o,o}function Ir(r,t){var e=Kr(r),o=Kr(t);return{start:{offset:r,line:e.line,column:e.column},end:{offset:t,line:o.line,column:o.column}}}function Cr(r){vr<gr||(vr>gr&&(gr=vr,Ar=[]),Ar.push(r))}function Fr(r,t,e){return new o(o.buildMessage(r,t),r,t,e)}function xr(){var t,e,o,i,u,a,s,c,l;for(t=vr,e=[],o=Gr();o!==n;)e.push(o),o=Gr();if(e!==n){for(o=[],i=Er();i!==n;)o.push(i),i=Er();if(o!==n)if((i=function(){var t,e,o,i,u,a,s,c;t=vr,e=vr,32===r.charCodeAt(vr)?(o=" ",vr++):(o=n,Cr(p));if(o!==n){for(i=[],u=Br();u!==n;)i.push(u),u=Br();i!==n&&(u=Pr())!==n?e=o=[o,i,u]:(vr=e,e=n)}else vr=e,e=n;e===n&&(e=null);if(e!==n){if(o=vr,43===r.charCodeAt(vr)?(i="+",vr++):(i=n,Cr(v)),i!==n){for(u=[],a=Br();a!==n;)u.push(a),a=Br();u!==n&&(a=Pr())!==n?o=i=[i,u,a]:(vr=o,o=n)}else vr=o,o=n;if(o===n&&(o=null),o!==n){if(i=[],(u=Ur())!==n)for(;u!==n;)i.push(u),u=Ur();else i=n;if(i!==n){if(u=vr,43===r.charCodeAt(vr)?(a="+",vr++):(a=n,Cr(v)),a!==n){for(s=[],c=Br();c!==n;)s.push(c),c=Br();s!==n&&(c=Pr())!==n?u=a=[a,s,c]:(vr=u,u=n)}else vr=u,u=n;u===n&&(u=null),u!==n?(t,e=function(r){for(var t=[],e=0;e<9;e++){for(var o=[],n=0;n<9;n++)o.push(r[n][8-e]);t.push(o)}return{preset:"OTHER",data:{board:t}}}(i),t=e):(vr=t,t=n)}else vr=t,t=n}else vr=t,t=n}else vr=t,t=n;return t}())===n&&(i=null),i!==n){for(u=[],a=Er();a!==n;)u.push(a),a=Er();if(u!==n)if((a=wr())===n&&(a=null),a!==n)if((s=Sr())!==n){for(c=[],l=Rr();l!==n;)c.push(l),l=Rr();c!==n?((l=Pr())===n&&(l=null),l!==n?(t,t=e=function(r,t,e,o,n){for(var i={header:{},moves:o},u=0;u<r.length;u++)r[u]&&(i.header[r[u].k]=r[u].v);for(u=0;u<e.length;u++)e[u]&&(i.header[e[u].k]=e[u].v);if(t)i.initial=t;else if(i.header["手合割"]){var a=function(r){return{"平手":"HIRATE","香落ち":"KY","右香落ち":"KY_R","角落ち":"KA","飛車落ち":"HI","飛香落ち":"HIKY","二枚落ち":"2","三枚落ち":"3","四枚落ち":"4","五枚落ち":"5","左五枚落ち":"5_L","六枚落ち":"6","八枚落ち":"8","十枚落ち":"10","その他":"OTHER"}[r.replace(/\s/g,"")]}(i.header["手合割"]);"OTHER"!=a&&(i.initial={preset:a})}i.initial&&i.initial.data&&(i.header["手番"]?(i.initial.data.color="下先".indexOf(i.header["手番"])>=0?0:1,delete i.header["手番"]):i.initial.data.color=0,i.initial.data.hands=[Dr(i.header["先手の持駒"]||i.header["下手の持駒"]),Dr(i.header["後手の持駒"]||i.header["上手の持駒"])],delete i.header["先手の持駒"],delete i.header["下手の持駒"],delete i.header["後手の持駒"],delete i.header["上手の持駒"]);var s=[{te:0,moves:o}];for(u=0;u<n.length;u++){for(var c=n[u],l=s.pop();l.te>=c.te;)l=s.pop();var f=l.moves[c.te-l.te];f.forks=f.forks||[],f.forks.push(c.moves),s.push(l),s.push(c)}return i}(o,i,u,s,c)):(vr=t,t=n)):(vr=t,t=n)}else vr=t,t=n;else vr=t,t=n;else vr=t,t=n}else vr=t,t=n;else vr=t,t=n}else vr=t,t=n;return t}function Er(){var t,e,o,i,u,h;if(t=vr,e=[],a.test(r.charAt(vr))?(o=r.charAt(vr),vr++):(o=n,Cr(s)),o!==n)for(;o!==n;)e.push(o),a.test(r.charAt(vr))?(o=r.charAt(vr),vr++):(o=n,Cr(s));else e=n;if(e!==n)if(65306===r.charCodeAt(vr)?(o="：",vr++):(o=n,Cr(c)),o!==n){for(i=[],u=Br();u!==n;)i.push(u),u=Br();i!==n&&(u=Pr())!==n?(t,h=i,t=e={k:e.join(""),v:h.join("")}):(vr=t,t=n)}else vr=t,t=n;else vr=t,t=n;return t===n&&(t=vr,(e=br())!==n?("手番"===r.substr(vr,2)?(o="手番",vr+=2):(o=n,Cr(l)),o!==n&&(i=Pr())!==n?(t,t=e={k:"手番",v:e}):(vr=t,t=n)):(vr=t,t=n),t===n&&(t=vr,"盤面回転"===r.substr(vr,4)?(e="盤面回転",vr+=4):(e=n,Cr(f)),e!==n&&(o=Pr())!==n?(t,t=e=null):(vr=t,t=n))),t}function br(){var t;return h.test(r.charAt(vr))?(t=r.charAt(vr),vr++):(t=n,Cr(d)),t}function Ur(){var t,e,o,i,u,a;if(t=vr,124===r.charCodeAt(vr)?(e="|",vr++):(e=n,Cr(m)),e!==n){if(o=[],(i=Mr())!==n)for(;i!==n;)o.push(i),i=Mr();else o=n;if(o!==n)if(124===r.charCodeAt(vr)?(i="|",vr++):(i=n,Cr(m)),i!==n){if(u=[],(a=Br())!==n)for(;a!==n;)u.push(a),a=Br();else u=n;u!==n&&(a=Pr())!==n?(t,t=e=o):(vr=t,t=n)}else vr=t,t=n;else vr=t,t=n}else vr=t,t=n;return t}function Mr(){var t,e,o;return t=vr,(e=function(){var t,e;t=vr,32===r.charCodeAt(vr)?(e=" ",vr++):(e=n,Cr(p));e===n&&(43===r.charCodeAt(vr)?(e="+",vr++):(e=n,Cr(v)),e===n&&(94===r.charCodeAt(vr)?(e="^",vr++):(e=n,Cr(A))));e!==n&&(t,e=0);(t=e)===n&&(t=vr,118===r.charCodeAt(vr)?(e="v",vr++):(e=n,Cr(y)),e===n&&(86===r.charCodeAt(vr)?(e="V",vr++):(e=n,Cr(k))),e!==n&&(t,e=1),t=e);return t}())!==n&&(o=Nr())!==n?(t,t=e={color:e,kind:o}):(vr=t,t=n),t===n&&(t=vr," ・"===r.substr(vr,2)?(e=" ・",vr+=2):(e=n,Cr(g)),e!==n&&(t,e={}),t=e),t}function wr(){var t,e,o,i;return t=vr,"手数----指手--"===r.substr(vr,10)?(e="手数----指手--",vr+=10):(e=n,Cr(K)),e!==n?("-------消費時間--"===r.substr(vr,13)?(o="-------消費時間--",vr+=13):(o=n,Cr(I)),o===n&&(o=null),o!==n&&(i=Pr())!==n?t=e=[e,o,i]:(vr=t,t=n)):(vr=t,t=n),t}function Sr(){var t,e,o,i,u,a,s;if(t=vr,(e=function(){var r,t,e;r=vr,t=[],e=Hr();for(;e!==n;)t.push(e),e=Hr();t!==n?((e=Or())===n&&(e=null),e!==n?(r,t=0==(o=t).length?{}:{comments:o},r=t):(vr=r,r=n)):(vr=r,r=n);var o;return r}())!==n)if((o=wr())===n&&(o=null),o!==n){for(i=[],u=Tr();u!==n;)i.push(u),u=Tr();i!==n?((u=function(){var t,e,o,i,u,a,s,c,l,f,h,d;t=vr,"まで"===r.substr(vr,2)?(e="まで",vr+=2):(e=n,Cr(D));if(e!==n){if(o=[],E.test(r.charAt(vr))?(i=r.charAt(vr),vr++):(i=n,Cr(b)),i!==n)for(;i!==n;)o.push(i),E.test(r.charAt(vr))?(i=r.charAt(vr),vr++):(i=n,Cr(b));else o=n;o!==n?(25163===r.charCodeAt(vr)?(i="手",vr++):(i=n,Cr(z)),i!==n?(u=vr,12391===r.charCodeAt(vr)?(a="で",vr++):(a=n,Cr(V)),a!==n&&(s=br())!==n?("手の"===r.substr(vr,2)?(c="手の",vr+=2):(c=n,Cr(J)),c!==n?(l=vr,"勝ち"===r.substr(vr,2)?(f="勝ち",vr+=2):(f=n,Cr(Z)),f!==n&&(l,f="TORYO"),(l=f)===n&&(l=vr,"反則"===r.substr(vr,2)?(f="反則",vr+=2):(f=n,Cr($)),f!==n?(h=vr,"勝ち"===r.substr(vr,2)?(d="勝ち",vr+=2):(d=n,Cr(Z)),d!==n&&(h,d="ILLEGAL_ACTION"),(h=d)===n&&(h=vr,"負け"===r.substr(vr,2)?(d="負け",vr+=2):(d=n,Cr(q)),d!==n&&(h,d="ILLEGAL_MOVE"),h=d),h!==n?(l,f=Q(0,h),l=f):(vr=l,l=n)):(vr=l,l=n)),l!==n?(u,a=Q(0,l),u=a):(vr=u,u=n)):(vr=u,u=n)):(vr=u,u=n),u===n&&(u=vr,"で時間切れにより"===r.substr(vr,8)?(a="で時間切れにより",vr+=8):(a=n,Cr(X)),a!==n&&(s=br())!==n?("手の勝ち"===r.substr(vr,4)?(c="手の勝ち",vr+=4):(c=n,Cr(rr)),c!==n?(u,u=a="TIME_UP"):(vr=u,u=n)):(vr=u,u=n),u===n&&(u=vr,"で中断"===r.substr(vr,3)?(a="で中断",vr+=3):(a=n,Cr(tr)),a!==n&&(u,a="CHUDAN"),(u=a)===n&&(u=vr,"で封じ手"===r.substr(vr,4)?(a="で封じ手",vr+=4):(a=n,Cr(er)),a!==n&&(u,a="CHUDAN"),(u=a)===n&&(u=vr,"で持将棋"===r.substr(vr,4)?(a="で持将棋",vr+=4):(a=n,Cr(or)),a!==n&&(u,a="JISHOGI"),(u=a)===n&&(u=vr,"で千日手"===r.substr(vr,4)?(a="で千日手",vr+=4):(a=n,Cr(nr)),a!==n&&(u,a="SENNICHITE"),(u=a)===n&&(u=vr,12391===r.charCodeAt(vr)?(a="で",vr++):(a=n,Cr(V)),a===n&&(a=null),a!==n?(35440===r.charCodeAt(vr)?(s="詰",vr++):(s=n,Cr(ir)),s!==n?(12415===r.charCodeAt(vr)?(c="み",vr++):(c=n,Cr(ur)),c===n&&(c=null),c!==n?(u,u=a="TSUMI"):(vr=u,u=n)):(vr=u,u=n)):(vr=u,u=n),u===n&&(u=vr,"で不詰"===r.substr(vr,3)?(a="で不詰",vr+=3):(a=n,Cr(ar)),a!==n&&(u,a="FUZUMI"),u=a))))))),u!==n&&(a=Pr())!==n?(t,t=e=u):(vr=t,t=n)):(vr=t,t=n)):(vr=t,t=n)}else vr=t,t=n;return t}())===n&&(u=null),u!==n?(t,a=e,(s=i).unshift(a),t=e=s):(vr=t,t=n)):(vr=t,t=n)}else vr=t,t=n;else vr=t,t=n;return t}function Tr(){var t,e,o,i,u,a,s;if(t=vr,(e=function(){var t,e,o,i,u,a,s,c;t=vr,e=[],32===r.charCodeAt(vr)?(o=" ",vr++):(o=n,Cr(p));for(;o!==n;)e.push(o),32===r.charCodeAt(vr)?(o=" ",vr++):(o=n,Cr(p));if(e!==n)if((o=function(){var t,e;t=[],E.test(r.charAt(vr))?(e=r.charAt(vr),vr++):(e=n,Cr(b));if(e!==n)for(;e!==n;)t.push(e),E.test(r.charAt(vr))?(e=r.charAt(vr),vr++):(e=n,Cr(b));else t=n;return t}())!==n){for(i=[],32===r.charCodeAt(vr)?(u=" ",vr++):(u=n,Cr(p));u!==n;)i.push(u),32===r.charCodeAt(vr)?(u=" ",vr++):(u=n,Cr(p));if(i!==n){if(u=vr,(a=function(){var t,e,o,i;t=vr,(e=function(){var t,e,o;t=vr,(e=function(){var t,e;t=vr,S.test(r.charAt(vr))?(e=r.charAt(vr),vr++):(e=n,Cr(T));e!==n&&(t,e="０１２３４５６７８９".indexOf(e));return t=e}())!==n&&(o=function(){var t,e;t=vr,O.test(r.charAt(vr))?(e=r.charAt(vr),vr++):(e=n,Cr(N));e!==n&&(t,e="〇一二三四五六七八九".indexOf(e));return t=e}())!==n?(t,t=e={x:e,y:o}):(vr=t,t=n);t===n&&(t=vr,21516===r.charCodeAt(vr)?(e="同",vr++):(e=n,Cr(M)),e!==n?(12288===r.charCodeAt(vr)?(o="　",vr++):(o=n,Cr(w)),o===n&&(o=null),o!==n?(t,t=e=null):(vr=t,t=n)):(vr=t,t=n));return t}())!==n&&(o=Nr())!==n?(25104===r.charCodeAt(vr)?(i="成",vr++):(i=n,Cr(U)),i===n&&(i=null),i!==n?(t,t=e={to:e,piece:o,promote:!!i}):(vr=t,t=n)):(vr=t,t=n);return t}())!==n&&(s=function(){var t,e,o,i,u;t=vr,25171===r.charCodeAt(vr)?(e="打",vr++):(e=n,Cr(P));e!==n&&(t,e=null);(t=e)===n&&(t=vr,40===r.charCodeAt(vr)?(e="(",vr++):(e=n,Cr(G)),e!==n?(Y.test(r.charAt(vr))?(o=r.charAt(vr),vr++):(o=n,Cr(_)),o!==n?(Y.test(r.charAt(vr))?(i=r.charAt(vr),vr++):(i=n,Cr(_)),i!==n?(41===r.charCodeAt(vr)?(u=")",vr++):(u=n,Cr(B)),u!==n?(t,a=i,e={x:parseInt(o),y:parseInt(a)},t=e):(vr=t,t=n)):(vr=t,t=n)):(vr=t,t=n)):(vr=t,t=n));var a;return t}())!==n?(u,f=s,h={piece:(l=a).piece},l.to?h.to=l.to:h.same=!0,l.promote&&(h.promote=!0),f&&(h.from=f),u=a=h):(vr=u,u=n),u===n){for(u=vr,a=[],F.test(r.charAt(vr))?(s=r.charAt(vr),vr++):(s=n,Cr(x));s!==n;)a.push(s),F.test(r.charAt(vr))?(s=r.charAt(vr),vr++):(s=n,Cr(x));a!==n&&(u,a=a.join("")),u=a}if(u!==n){for(a=[],32===r.charCodeAt(vr)?(s=" ",vr++):(s=n,Cr(p));s!==n;)a.push(s),32===r.charCodeAt(vr)?(s=" ",vr++):(s=n,Cr(p));a!==n?((s=function(){var t,e,o,i,u,a,s;t=vr,40===r.charCodeAt(vr)?(e="(",vr++):(e=n,Cr(G));if(e!==n){for(o=[],32===r.charCodeAt(vr)?(i=" ",vr++):(i=n,Cr(p));i!==n;)o.push(i),32===r.charCodeAt(vr)?(i=" ",vr++):(i=n,Cr(p));o!==n&&(i=function(){var t,e,o,i,u;t=vr,e=[],E.test(r.charAt(vr))?(o=r.charAt(vr),vr++):(o=n,Cr(b));if(o!==n)for(;o!==n;)e.push(o),E.test(r.charAt(vr))?(o=r.charAt(vr),vr++):(o=n,Cr(b));else e=n;if(e!==n)if(58===r.charCodeAt(vr)?(o=":",vr++):(o=n,Cr(L)),o!==n){if(i=[],E.test(r.charAt(vr))?(u=r.charAt(vr),vr++):(u=n,Cr(b)),u!==n)for(;u!==n;)i.push(u),E.test(r.charAt(vr))?(u=r.charAt(vr),vr++):(u=n,Cr(b));else i=n;i!==n?(t,a=i,e={m:jr(e),s:jr(a)},t=e):(vr=t,t=n)}else vr=t,t=n;else vr=t,t=n;var a;return t}())!==n?(47===r.charCodeAt(vr)?(u="/",vr++):(u=n,Cr(j)),u!==n&&(a=function(){var t,e,o,i,u,a,s;t=vr,e=[],E.test(r.charAt(vr))?(o=r.charAt(vr),vr++):(o=n,Cr(b));if(o!==n)for(;o!==n;)e.push(o),E.test(r.charAt(vr))?(o=r.charAt(vr),vr++):(o=n,Cr(b));else e=n;if(e!==n)if(58===r.charCodeAt(vr)?(o=":",vr++):(o=n,Cr(L)),o!==n){if(i=[],E.test(r.charAt(vr))?(u=r.charAt(vr),vr++):(u=n,Cr(b)),u!==n)for(;u!==n;)i.push(u),E.test(r.charAt(vr))?(u=r.charAt(vr),vr++):(u=n,Cr(b));else i=n;if(i!==n)if(58===r.charCodeAt(vr)?(u=":",vr++):(u=n,Cr(L)),u!==n){if(a=[],E.test(r.charAt(vr))?(s=r.charAt(vr),vr++):(s=n,Cr(b)),s!==n)for(;s!==n;)a.push(s),E.test(r.charAt(vr))?(s=r.charAt(vr),vr++):(s=n,Cr(b));else a=n;a!==n?(t,c=i,l=a,e={h:jr(e),m:jr(c),s:jr(l)},t=e):(vr=t,t=n)}else vr=t,t=n;else vr=t,t=n}else vr=t,t=n;else vr=t,t=n;var c,l;return t}())!==n?(41===r.charCodeAt(vr)?(s=")",vr++):(s=n,Cr(B)),s!==n?(t,t=e={now:i,total:a}):(vr=t,t=n)):(vr=t,t=n)):(vr=t,t=n)}else vr=t,t=n;return t}())===n&&(s=null),s!==n?(43===r.charCodeAt(vr)?(c="+",vr++):(c=n,Cr(v)),c===n&&(c=null),c!==n&&Pr()!==n?(t,t=e={move:u,time:s}):(vr=t,t=n)):(vr=t,t=n)):(vr=t,t=n)}else vr=t,t=n}else vr=t,t=n}else vr=t,t=n;else vr=t,t=n;var l,f,h;return t}())!==n){for(o=[],i=Hr();i!==n;)o.push(i),i=Hr();o!==n?((i=Or())===n&&(i=null),i!==n?(t,u=e,s={},(a=o).length>0&&(s.comments=a),"object"==typeof u.move?s.move=u.move:s.special={"中断":"CHUDAN","封じ手":"CHUDAN","投了":"TORYO","持将棋":"JISHOGI","千日手":"SENNICHITE","詰み":"TSUMI","不詰":"FUZUMI","切れ負け":"TIME_UP","反則勝ち":"ILLEGAL_ACTION","反則負け":"ILLEGAL_MOVE"}[u.move],u.time&&(s.time=u.time),t=e=s):(vr=t,t=n)):(vr=t,t=n)}else vr=t,t=n;return t}function Or(){var t,e,o,i;if(t=vr,38===r.charCodeAt(vr)?(e="&",vr++):(e=n,Cr(C)),e!==n){for(o=[],i=Br();i!==n;)o.push(i),i=Br();o!==n&&(i=Pr())!==n?t=e=[e,o,i]:(vr=t,t=n)}else vr=t,t=n;return t}function Nr(){var t,e,o;return t=vr,25104===r.charCodeAt(vr)?(e="成",vr++):(e=n,Cr(U)),e===n&&(e=null),e!==n?(H.test(r.charAt(vr))?(o=r.charAt(vr),vr++):(o=n,Cr(R)),o!==n?(t,t=e=Wr((e||"")+o)):(vr=t,t=n)):(vr=t,t=n),t}function Hr(){var t,e,o,i;if(t=vr,42===r.charCodeAt(vr)?(e="*",vr++):(e=n,Cr(W)),e!==n){for(o=[],i=Br();i!==n;)o.push(i),i=Br();o!==n&&(i=Pr())!==n?(t,t=e=o.join("")):(vr=t,t=n)}else vr=t,t=n;if(t===n)if(t=vr,38===r.charCodeAt(vr)?(e="&",vr++):(e=n,Cr(C)),e!==n){for(o=[],i=Br();i!==n;)o.push(i),i=Br();o!==n&&(i=Pr())!==n?(t,t=e="&"+o.join("")):(vr=t,t=n)}else vr=t,t=n;return t}function Rr(){var t,e,o,i,u,a,s;if(t=vr,"変化："===r.substr(vr,3)?(e="変化：",vr+=3):(e=n,Cr(sr)),e!==n){for(o=[],32===r.charCodeAt(vr)?(i=" ",vr++):(i=n,Cr(p));i!==n;)o.push(i),32===r.charCodeAt(vr)?(i=" ",vr++):(i=n,Cr(p));if(o!==n){if(i=[],E.test(r.charAt(vr))?(u=r.charAt(vr),vr++):(u=n,Cr(b)),u!==n)for(;u!==n;)i.push(u),E.test(r.charAt(vr))?(u=r.charAt(vr),vr++):(u=n,Cr(b));else i=n;i!==n?(25163===r.charCodeAt(vr)?(u="手",vr++):(u=n,Cr(z)),u!==n&&Pr()!==n&&(a=Sr())!==n?(t,s=a,t=e={te:parseInt(i.join("")),moves:s.slice(1)}):(vr=t,t=n)):(vr=t,t=n)}else vr=t,t=n}else vr=t,t=n;return t}function Pr(){var r,t,e,o;if(r=vr,t=[],(e=_r())!==n)for(;e!==n;)t.push(e),e=_r();else t=n;if(t!==n){for(e=[],o=Gr();o!==n;)e.push(o),o=Gr();e!==n?r=t=[t,e]:(vr=r,r=n)}else vr=r,r=n;return r}function Gr(){var t,e,o,i;if(t=vr,35===r.charCodeAt(vr)?(e="#",vr++):(e=n,Cr(cr)),e!==n){for(o=[],i=Br();i!==n;)o.push(i),i=Br();o!==n&&(i=_r())!==n?t=e=[e,o,i]:(vr=t,t=n)}else vr=t,t=n;return t}function Yr(){var t;return 32===r.charCodeAt(vr)?(t=" ",vr++):(t=n,Cr(p)),t===n&&(9===r.charCodeAt(vr)?(t="\t",vr++):(t=n,Cr(lr))),t}function _r(){var t,e,o,i,u;for(t=vr,e=[],o=Yr();o!==n;)e.push(o),o=Yr();return e!==n?(10===r.charCodeAt(vr)?(o="\n",vr++):(o=n,Cr(fr)),o===n&&(o=vr,13===r.charCodeAt(vr)?(i="\r",vr++):(i=n,Cr(hr)),i!==n?(10===r.charCodeAt(vr)?(u="\n",vr++):(u=n,Cr(fr)),u===n&&(u=null),u!==n?o=i=[i,u]:(vr=o,o=n)):(vr=o,o=n)),o!==n?t=e=[e,o]:(vr=t,t=n)):(vr=t,t=n),t}function Br(){var t;return dr.test(r.charAt(vr))?(t=r.charAt(vr),vr++):(t=n,Cr(pr)),t}function jr(r){return parseInt(r.join(""),10)}function Lr(r){switch(r.length){case 1:return"〇一二三四五六七八九十".indexOf(r);case 2:return"〇一二三四五六七八九十".indexOf(r[1])+10;default:throw"21以上の数値に対応していません"}}function Wr(r){return"成"==r[0]?{"香":"NY","桂":"NK","銀":"NG"}[r[1]]:{"歩":"FU","香":"KY","桂":"KE","銀":"GI","金":"KI","角":"KA","飛":"HI","玉":"OU","王":"OU","と":"TO","杏":"NY","圭":"NK","全":"NG","馬":"UM","竜":"RY","龍":"RY"}[r]}function Dr(r){var t=r.split(/[ 　]/),e={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0};if(""==r)return e;for(var o=0;o<t.length;o++)""!=t[o]&&(e[Wr(t[o][0])]=1==t[o].length?1:Lr(t[o].slice(1)));return e}if((e=u())!==n&&vr===r.length)return e;throw e!==n&&vr<r.length&&Cr({type:"end"}),Fr(Ar,gr<r.length?r.charAt(gr):null,gr<r.length?Ir(gr,gr+1):Ir(gr,gr))}}}]);